!function(t,e,i,n,r,o,s){var a,u;!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=68)}([function(t,e,i){"use strict";var n,r,o,s,a,u,c,l,h,d,p,f,y,m,g,v,b,O,_,E,A,w;Object.defineProperty(e,"__esModule",{value:!0}),(r=n||(n={})).ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID="Oracle-Mobile-DIAGNOSTIC-SESSION-ID",r.ORACLE_MOBILE_DEVICE_ID="Oracle-Mobile-DEVICE-ID",r.ORACLE_MOBILE_CLIENT_REQUEST_TIME="Oracle-Mobile-CLIENT-REQUEST-TIME",r.ORACLE_MOBILE_ANALYTICS_APPLICATION_ID="Oracle-Mobile-Analytics-Application-Id",r.ORACLE_MOBILE_NAME="Oracle-Mobile-Name",r.ORACLE_MOBILE_CREATED_BY="Oracle-Mobile-Created-By",r.ORACLE_MOBILE_CREATED_ON="Oracle-Mobile-Created-On",r.ORACLE_MOBILE_MODIFIED_BY="Oracle-Mobile-Modified-By",r.ORACLE_MOBILE_MODIFIED_ON="Oracle-Mobile-Modified-On",r.ORACLE_MOBILE_SYNC_RESOURCE_TYPE="Oracle-Mobile-Sync-Resource-Type",r.ORACLE_MOBILE_SYNC_AGENT="Oracle-Mobile-Sync-Agent",r.LOCATION="Location",r.ORACLE_MOBILE_BACKEND_ID="Oracle-Mobile-Backend-Id",r.ORACLE_MOBILE_SOCIAL_IDENTITY_PROVIDER="Oracle-Mobile-Social-Identity-Provider",r.ORACLE_MOBILE_SOCIAL_ACCESS_TOKEN="Oracle-Mobile-Social-Access-Token",r.ORACLE_MOBILE_CLIENT_SDK_INFO="Oracle-Mobile-Client-SDK-Info",r.ACCEPT="Accept",r.CONTENT_TYPE="Content-Type",r.E_TAG="ETag",r.IF_MATCH="If-Match",r.AUTHORIZATION="Authorization",r.X_USER_IDENTITY_DOMAIN_NAME="X-USER-IDENTITY-DOMAIN-NAME",r.X_RESOURCE_IDENTITY_DOMAIN_NAME="X-RESOURCE-IDENTITY-DOMAIN-NAME",r.ACCEPT_ENCODING="Accept-Encoding",r.IF_MODIFIED_SINCE="if-modified-since",r.IF_NONE_MATCH="if-none-match",e.Headers=n,(s=o||(o={})).APPLICATION_JSON="application/json",s.TEXT_PLAIN="text/plain",s.X_WWW_FORM_FORM_URLENCODED="application/x-www-form-urlencoded; charset=utf-8",e.ContentTypes=o,(u=a||(a={})).GET="GET",u.PUT="PUT",u.PATCH="PATCH",u.POST="POST",u.DELETE="DELETE",u.HEAD="HEAD",e.HttpMethods=a,(l=c||(c={})).ITEM="item",l.COLLECTION="collection",l.FILE="file",e.ResourceTypes=c,(d=h||(h={})).basic="basic",d.oauth="oauth",d.facebook="facebook",d.token="token",e.AuthenticationTypes=h,(f=p||(p={})).STORAGE="Storage",f.AUTHORIZATION="Authorization",f.USER_MANAGEMENT="UserManagement",f.APP_POLICES="AppPolicies",f.LOCATION="Location",f.SYNC="Sync",f.SYNC_EXPRESS="SyncExpress",f.NOTIFICATIONS="Notifications",f.MCS_ANALYTICS="MCSAnalytics",f.ANALYTICS="Analytics",f.CUSTOM_CODE="CustomCode",f.APP_CONFIG="AppConfig",e.ModuleNames=p,(m=y||(y={})).JAVASCRIPT="Javascript",m.CORDOVA="Cordova",m.REACT_NATIVE="ReactNative",e.PlatformNames=y,(v=g||(g={})).ANDROID="android",v.IOS="ios",e.DevicePlatforms=g,(O=b||(b={})).FCM="FCM",O.APNS="APNS",O.WNS="WNS",O.SYNIVERSE="SYNIVERSE",e.NotificationProviders=b,(E=_||(_={})).JSON="json",E.BLOB="blob",E.ARRAY_BUFFER="arraybuffer",E.DOCUMENT="document",E.TEXT="text",e.XMLHttpRequestResponseTypes=_,(w=A||(A={})).GENERIC="Generic",w.MCS="MCS",w.ORACLE_REST="OracleRest",e.SyncRequestHandlerTypes=A},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.module=t}return t.prototype.debug=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.log(t.LOG_LEVEL.DEBUG,e)},t.prototype.error=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.log(t.LOG_LEVEL.ERROR,e)},t.prototype.info=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.log(t.LOG_LEVEL.INFO,e)},t.prototype.warn=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.log(t.LOG_LEVEL.WARN,e)},t.prototype.log=function(e,i){if(t.logLevel>=e){i.unshift("[mcs."+this.module+"]");var n=void 0;switch(t.logLevel){case t.LOG_LEVEL.ERROR:n=console.error;break;case t.LOG_LEVEL.WARN:n=console.warn;break;case t.LOG_LEVEL.INFO:n=console.info;break;case t.LOG_LEVEL.DEBUG:n=console.debug}t.historyEnabled&&(t.history.push(Object.assign({},i,{level:e})),t.historySize<=t.history.length&&t.history.shift()),n.apply(console,i)}},t.LOG_LEVEL={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},t.logLevel=t.LOG_LEVEL.ERROR,t.historyEnabled=!1,t.historySize=100,t.history=[],t}();e.Logger=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e,i){this.statusCode=0,this.data=null,this.headers=null,this.statusCode=t,this.data=e,this.headers=i}}();e.NetworkResponse=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this._keys=[],this._values=[];for(var e=0;e<t.length;e++)this[t[e].key.toString()]=t[e].value,this._keys.push(t[e].key),this._values.push(t[e].value)}return t.prototype.add=function(t,e){this[t.toString()]=e,this._keys.push(t),this._values.push(e)},t.prototype.remove=function(t){var e=this._keys.indexOf(t,0);this._keys.splice(e,1),this._values.splice(e,1),delete this[t.toString()]},t.prototype.keys=function(){return this._keys},t.prototype.values=function(){return this._values},t.prototype.containsKey=function(t){return void 0!==this[t.toString()]},t.prototype.toLookup=function(){return this},t}();e.Dictionary=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),s=i(2),a=i(0),u=function(t){function e(e,i){var n=t.call(this,e.statusCode,e.data,e.headers)||this;return n.accessToken=i,n}return r(e,t),e}(s.NetworkResponse);e.AuthenticationResponse=u;var c=function(){function t(t,e){this.utils=t,this.platform=e,this._onAuthenticationCallbacks=[],this.logger=new o.Logger("Authorization")}return Object.defineProperty(t.prototype,"isAuthorized",{get:function(){return this._isAuthorized},enumerable:!0,configurable:!0}),t.prototype.getAccessToken=function(){return this._accessToken},t.prototype._setAccessToken=function(t){this._accessToken=t},t.prototype._getIsAnonymous=function(){return this._isAnonymous},t.prototype._getIsAuthorized=function(){return this._isAuthorized},t.prototype._getAnonymousAccessToken=function(){return this._anonymousAccessToken},t.prototype._authenticateAnonymousInvoke=function(t,e,i,n,r){return this.logout(),t=this._getHeaders(t),t=this._getAnonymousAuthorizationHeaders(t),this.platform.invokeService({url:e,method:i,headers:t,withCredentials:n,data:r,module:a.ModuleNames.AUTHORIZATION}).then(function(t){return new u(t,null)}).then(this._anonymousTokenResponseConverter.bind(this)).catch(function(t){return this.logger.error("Login failed with error: "+t.statusCode),this._clearState(),Promise.reject(t)}.bind(this)).then(this._authenticateAnonymousSuccess.bind(this))},t.prototype._getHeaders=function(t){return t},t.prototype._authenticateAnonymousSuccess=function(t){return this.logger.info("User logged in anonymously "+t.statusCode),this._setAuthenticateAnonymousSuccess(t.accessToken),t},t.prototype._setAuthenticateAnonymousSuccess=function(t){this._isAnonymous=!0,this._isAuthorized=!0,this._anonymousAccessToken=t;for(var e=0;e<this._onAuthenticationCallbacks.length;e++)this._onAuthenticationCallbacks[e](t)},t.prototype._authenticateError=function(t){this.logger.error("Login failed with error: "+t.statusCode),this._clearState()},t.prototype._clearState=function(){this._accessToken=null,this._isAnonymous=!1,this._anonymousAccessToken=null,this._isAuthorized=!1},t.prototype.onAuthentication=function(t){this._onAuthenticationCallbacks.push(t)},t}();e.Authorization=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(10),r=i(15),o=i(0),s=function(){function t(t,e,i,n,r,o,s,a){this.backend=t,this.apiName=e,this.endpointPath=i,this.resolvingOfflineUpdate=n,this.utils=r,this.platform=o,this.options=s,this.common=a}return t.prototype.getHttpHeaders=function(t){var e=this.backend.getHttpHeaders(t);return e.add(o.Headers.ORACLE_MOBILE_SYNC_AGENT,"true"),e},t.prototype.getType=function(t,e){var i=n.SyncResourceType.file,r=t[o.Headers.ORACLE_MOBILE_SYNC_RESOURCE_TYPE.toLowerCase()];if(null!=r)r===o.ResourceTypes.ITEM?i=n.SyncResourceType.item:r===o.ResourceTypes.COLLECTION&&(i=n.SyncResourceType.collection);else if(this.common.isString(e))try{var s=JSON.parse(e);i=this.common.isArray(s)?n.SyncResourceType.collection:n.SyncResourceType.item}catch(t){i=n.SyncResourceType.file}return i},t.prototype.getUri=function(t,e){var i=t&&t.headers?t.headers[o.Headers.LOCATION.toLowerCase()]:null;if(null!=i)return"/"+i;var n=null;if(t.data&&(n="string"==typeof t.data?""!==t.data?JSON.parse(t.data):null:t.data),n&&n[r.McsRequestHandler.URI_KEY]){var s=n[r.McsRequestHandler.URI_KEY];return delete n[r.McsRequestHandler.URI_KEY],s}return this.options.parseURL(e).path},t.prototype.createResource=function(t,e,i,r,s,a,u,c){var l=c.headers[o.Headers.LOCATION.toLowerCase()];l=null!=l?"/"+l:e;n.SyncResourceType.file;var h=s[o.Headers.ORACLE_MOBILE_SYNC_RESOURCE_TYPE.toLowerCase()];if(null!=h)h===o.ResourceTypes.ITEM?n.SyncResourceType.item:h===o.ResourceTypes.COLLECTION&&n.SyncResourceType.collection;else if(this.common.isString(u))try{var d=JSON.parse(u);this.common.isArray(d)?n.SyncResourceType.collection:n.SyncResourceType.item}catch(t){n.SyncResourceType.file}return null},t}();e.SyncProcessor=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),r=i(1),o=function(){function t(t,e,i,n,o){var s=this;this.dbName=t,this.$options=e,this.$common=i,this.$utils=n,this.logger=new r.Logger("RequestHandler"),this.prefix=e.dbPrefix,this.$db=this._createDatabase(o),e.onDbPrefixChange=function(t,e){s.prefix=e,s.$db=s._createDatabase(o)}}return t.prototype.isPersistentRequest=function(t){if(!t)throw new Error("request cannot be undefined or null value");if(!this.$common.isObject(t))throw new Error("request has to be defined object with properties like: url, data etc.");if(this.$common.isEmpty(t))throw new Error("request cannot be empty object, it request properties like: url, data etc.");if(this.$common.isArray(t)||this.$common.isFunction(t))throw new Error("request cannot be array or function");if(!("url"in t))throw new Error("request.url was not specified");return!0},t.prototype.isPersistentGetRequest=function(t){return this.isPersistentRequest(t),!0},t.prototype.isPostRequest=function(t){if(this.isPersistentRequest(t),!("data"in t))throw new Error("request.data was not defined!");if(!this.$common.isObject(t.data))throw new Error("request.data is not a object or array!");if(this.$common.isFunction(t.data))throw new Error("request.data cannot be function");return!0},t.prototype.isOfflinePersistObj=function(t){return!!("meta"in t&&t.meta.hasOwnProperty("offline-persist"))},t.prototype.isLokiDbObj=function(t){return!(!("$loki"in t&&"number"==typeof t.$loki)||isNaN(t.$loki))},t.prototype.buildFindQueryBasedOnUrlParams=function(t){var e={};t.attr.length>0&&(e[t.attr[0].name]=t.attr[0].pattern.indexOf("d")>=0?parseInt(t.attr[0].value,10):t.attr[0].value+"");return e},t.prototype.buildUniqueIDValue=function(t,e){var i=function(){return t.uri.tokens.length>1&&t.uri.tokens[t.uri.tokens.length-1].pattern.indexOf("d")>=0},n=function(t){return i()?parseInt(t,10):t+""};return this.$common.isEmpty(e)?n(this.$common.getUID()):"number"==typeof e&&i()?e:n(e)},t.prototype.handleGetRootArrayPayload=function(t,e,i){var n=this;if(e.uri.tokens.length>1){if(i.find().length>0){var r=e.uri.tokens[1].name;return i.removeWhere(function(e){var o=t.findIndex(function(t){return t[r]===e[r]});if(!(o>-1))return!n.isOfflinePersistObj(e);try{n.isOfflinePersistObj(e)?e=n.$common.deepExtend(t[o],e):n.$common.extendOwn(e,t[o]),i.update(e),t.splice(o,1)}catch(t){n.logger.error(t)}finally{return!1}}),t.forEach(function(t){n.isLokiDbObj(t)?i.update(t):i.insert(t)}),i.find()}return i.insert(t)}return i.removeWhere(function(t){return!n.isOfflinePersistObj(t)}),i.insert(t)},t.prototype.handleGetRootObjectPayload=function(t,e,i){var n=this;if(e.uri.tokens.length>1){var r=e.uri.tokens[1].name;if(!t.hasOwnProperty(r))throw this.logger.error("payload does not contain unique key specified in the URL settings"),new Error("payload does not contain unique key specified in the URL settings");var o={};o[r]=t[r];var s=i.findOne(o);return s?(this.isOfflinePersistObj(s)?s=this.$common.deepExtend(t,s):this.$common.extendOwn(s,t),i.update(s)):i.insert(t)}return i.removeWhere(function(t){return!n.isOfflinePersistObj(t)}),i.insert(t)},t.prototype.buildNestedPropertySearchString=function(t){var e="";if(t.attr.length>1)for(var i=1;i<t.attr.length;i++)t.attr[i].is?e.length>0?e+="."+t.attr[i].name:e+=t.attr[i].name:e.length>0?e+="."+t.attr[i].name+"["+t.attr[i].value+"]":e+=t.attr[i].value;return e},t.prototype.buildNestedPropertyArrayParams=function(t,e,i){void 0===i&&(i=!1);var n=[],r=e.attr;if(Array.isArray(r)&&r.length>0)for(var o=t.uri.tokens.length>1?t.uri.tokens.slice(1):[],s=0;s<r.length;s++){var a=r.length-1===s;if(r[s].is){if(n.push({name:r[s].name,value:null,isProperty:!0,isInteger:!1}),a&&o[s+1]&&i){var u=this.$utils.isUrlRegexInteger(o[s+1].pattern);n.push({name:o[s+1].name,value:u?this.$common.getUID():this.$common.getUID()+"",isProperty:!1,isInteger:u})}}else{var c=r[s].value||this.$common.getUID();n.push({name:r[s].name,value:c,isProperty:!1,isInteger:this.$utils.isUrlRegexInteger(o[s].pattern)})}}return n},t.prototype.createObjFromUrlParamsForExistingForPost=function(t,e,i,n,r){var o=this.buildNestedPropertyArrayParams(e,i),s=t;if(Array.isArray(o)&&o.length>0){var a=void 0;if(r){var u=this.getKeyForCurrentObject(e,i);a={key:u,value:r[u.name]}}s=this.$utils.setNestedProperty2(t,o,n,a)}else this.$common.extendOwn(t,n);return{obj:t,result:s}},t.prototype.getKeyForCurrentObject=function(t,e){var i=e.attr.length;return t.uri.tokens[i+1]},t.prototype.createObjFromUrlParamsForGETAction=function(t,e,i,n){var r=this.buildNestedPropertyArrayParams(e,i,!1),o=t;return Array.isArray(r)&&r.length>0&&(o=this.$utils.setNestedProperty2(t,r,n)),{obj:t,result:o}},t.prototype.getNestedPropertyFromUrlParamsForExisting=function(t,e,i){var n=this.buildNestedPropertyArrayParams(e,i,!1);return Array.isArray(n)&&n.length>0?this.$utils.getNestedProperty(t,n):t},t.prototype.markObjAsOfflineIfForced=function(t,e){return e?(this.isOfflinePersistObj(t)&&delete t.meta["offline-persist"],t):"meta"in t?(t.meta["offline-persist"]=!0,t):(t.meta={},t.meta["offline-persist"]=!0,t)},t.prototype.handleGet=function(t){var e=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(e.path);if(!i)throw new Error("Persistence.RequestHandler.get() given URI was not configured for persistence:"+e.path);var n=this.$utils.extractKeyValuesFromUrl2(i),r=this.$db.getCollectionByName(n.root),o=this.buildFindQueryBasedOnUrlParams(n);if(this.$common.isEmpty(o)){this.logger.debug("return all from db");var s=this.$common.cleanObjects(r.find());return this.buildResponseObject(s)}var a=r.findOne(o);if(a){var u=this.getNestedPropertyFromUrlParamsForExisting(a,i,n),c=this.$common.cleanObject(u);return this.buildResponseObject(c)}return null},t.prototype.handleGetStore=function(t){var e=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(e.path);if(!i)throw new Error("Persistence.RequestHandler.get() given URI was not configured for persistence:"+e.path);var n=this.$utils.extractKeyValuesFromUrl2(i),r=this.$db.getCollectionByName(n.root),o=this.getResponsePayload(t),s=this.buildFindQueryBasedOnUrlParams(n);if(this.$common.isEmpty(s)){if(!this.$common.isArray(o)||this.$common.isFunction(o)||this.$common.isEmpty(o)){if(!this.$common.isObject(o)||this.$common.isArray(o)||this.$common.isFunction(o)||this.$common.isEmpty(o))throw this.logger.error("handleGetStore","unknown or empty object passed for the operation"),new Error("RequestHandler.handleGetStore -> unknown or empty object passed for the operation");return this.handleGetRootObjectPayload(o,i,r)}var a=this.handleGetRootArrayPayload(o,i,r);return this.buildResponseObject(a)}var u=r.findOne(s),c=void 0;return u?(c=this.createObjFromUrlParamsForGETAction(u,i,n,o),r.update(c.obj)):(c=this.createObjFromUrlParamsForGETAction(s,i,n,o),r.insert(c.obj)),this.buildResponseObject(c.result)},t.prototype.handlePostRootArrayPayload=function(t,e,i,n){var r=this,o=e.uri.tokens.length>1?e.uri.tokens[1].name:null;return t.forEach(function(t){if(r.isLokiDbObj(t))r.markObjAsOfflineIfForced(t,n),i.update(t);else{if(!o||!t.hasOwnProperty(o)){var s=i.insert(t);return s[o]=r.buildUniqueIDValue(e),r.markObjAsOfflineIfForced(s,n),r.$common.cleanObject(i.update(s))}var a=i.findOne({keyNameToCompare:t[o]});a?(r.$common.extendOwn(a,t),r.markObjAsOfflineIfForced(a,n),i.update(a)):(r.markObjAsOfflineIfForced(t,n),i.insert(t))}}),this.$common.cleanObjects(i.find())},t.prototype.handlePostRootObjectPayload=function(t,e,i,n){var r=e.uri.tokens.length>1?e.uri.tokens[1].name:"";if(r&&!t.hasOwnProperty(r)){this.logger.info("get payload","does not have the key specified in the URL settings"),t[r]="";var o=i.insert(t);if(o)return o[r]=this.buildUniqueIDValue(e),this.markObjAsOfflineIfForced(o,n),this.$common.cleanObject(i.update(o));throw new Error("unable to store the payload object")}if(r&&t.hasOwnProperty(r)){var s={};s[r]=t[r];var a=i.findOne(s);if(a)return this.$common.extendOwn(a,t),this.markObjAsOfflineIfForced(a,n),this.$common.cleanObject(i.update(a));t[r]=this.buildUniqueIDValue(e,t[r])}return this.markObjAsOfflineIfForced(t,n),this.$common.cleanObject(i.insert(t))},t.prototype.handlePost=function(t,e){var i=this.$options.parseURL(t.url),n=this.$utils.isPersistUrl(i.path);if(!n)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+i.path);var r=this.$utils.extractKeyValuesFromUrl2(n),o=this.$db.getCollectionByName(r.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(r);if(!this.$common.isEmpty(a)){var u=o.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,n,r,s),l=n.uri.tokens[n.uri.tokens.length-1].name;return c.result[l]=this.buildUniqueIDValue(n,c.result[l]),this.markObjAsOfflineIfForced(c.obj,e),o.update(c.obj),this.$common.cleanObject(c.result)}c=this.createObjFromUrlParamsForExistingForPost(a,n,r,s);return this.markObjAsOfflineIfForced(c.obj,e),o.insert(c.obj),this.$common.cleanObject(c.result)}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,n,o,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,n,o,e);throw new Error("don't know what to do with the payload")},t.prototype.handlePut=function(t,e){var i=this.$options.parseURL(t.url),n=this.$utils.isPersistUrl(i.path);if(!n)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+i.path);var r=this.$utils.extractKeyValuesFromUrl2(n),o=this.$db.getCollectionByName(r.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(r);if(!this.$common.isEmpty(a)){var u=o.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,n,r,s);return this.markObjAsOfflineIfForced(c.obj,e),o.update(c.obj),c.result}c=this.createObjFromUrlParamsForExistingForPost(a,n,r,s);return this.markObjAsOfflineIfForced(c.obj,e),o.insert(c.obj),c.result}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,n,o,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,n,o,e);throw new Error("no key specified to recognise obj in the database for editing!")},t.prototype.handlePatch=function(t,e){var i=this.$options.parseURL(t.url),n=this.$utils.isPersistUrl(i.path);if(!n)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+i.path);var r=this.$utils.extractKeyValuesFromUrl2(n),o=this.$db.getCollectionByName(r.root),s=t.data,a=this.buildFindQueryBasedOnUrlParams(r);if(!this.$common.isEmpty(a)){var u=o.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,n,r,s);return this.markObjAsOfflineIfForced(c.obj,e),o.update(c.obj),c.result}c=this.createObjFromUrlParamsForExistingForPost(a,n,r,s);return this.markObjAsOfflineIfForced(c.obj,e),o.insert(c.obj),c.result}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,n,o,e);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,n,o,e);throw new Error("no key specified to recognise obj in the database for editing!")},t.prototype.handleDelete=function(t){var e=this.$options.parseURL(t.url),i=this.$utils.isPersistUrl(e.path);if(!i)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+e.path);var n=this.$utils.extractKeyValuesFromUrl2(i),r=this.$db.getCollectionByName(n.root),o=this.buildFindQueryBasedOnUrlParams(n);if(!this.$common.isEmpty(o)){if(a=r.findOne(o))return this.$common.cleanObject(r.remove(a));throw new Error("unable to find object with the given ID(%s) in the database")}if(t.hasOwnProperty("data")){var s=t.data;if(!this.$common.isEmpty(s)&&this.$common.isObject(s)&&!this.$common.isArray(s)){var a,u=i.uri.tokens.length>1?i.uri.tokens[1].name:null;if(u&&!t.data.hasOwnProperty(u))throw new Error("payload does not have the key required to delete the object");if(a=r.findOne({keyNameToCompare:t.data[u]}))return this.$common.cleanObject(r.remove(a))}}throw this.logger.error("payload does not have the key required to delete the object in the payload"),new Error("payload does not have the key required to delete the object in the payload")},t.prototype.postSuccessOperations=function(t){if("POST"===t.syncObj.method){var e=this.$common.clone(t),i=this.$options.parseURL(e.syncObj.url),n=this.$utils.isPersistUrl(i.path);if(!n)return this.logger.debug("sync post success operation exist"),t;var r=this.$utils.extractKeyValuesFromUrl2(n),o=this.$db.getCollectionByName(r.root),s=e.syncObj.data,a=e.response,u=this.buildFindQueryBasedOnUrlParams(r);if(this.$common.isEmpty(u)){var c=n.uri.tokens.length>1?n.uri.tokens[1].name:"";if(c&&!s.hasOwnProperty(c))return a=this.$common.extendOwn(s,a),this.$common.cleanObject(o.insert(a));var l={};l[c]=s[c];var h=o.findOne(l);return this.$common.extendOwn(h,a),this.$common.cleanObject(o.update(h))}var d=o.findOne(u);if(d){var p=this.createObjFromUrlParamsForExistingForPost(d,n,r,a,s),f=n.uri.tokens[n.uri.tokens.length-1].name;return p.result[f]=this.buildUniqueIDValue(n,p.result[f]),o.update(p.obj),this.$common.cleanObject(p.result)}p=this.createObjFromUrlParamsForExistingForPost(u,n,r,a);return o.insert(p.obj),this.$common.cleanObject(p.result)}return t},t.prototype.flush=function(t){var e=this;if(this.logger.info("Persistence.RequestHandler.flush()",t),this.$common.isEmpty(t))return this.$db.flush();var i=this.$options.parseURL(t),n=this.$utils.isPersistUrl(i.path);return new Promise(function(t,r){if(n){var o=e.$utils.extractKeyValuesFromUrl2(n);t(e.$db.getCollectionByName(o.root).removeDataOnly())}else r(new Error("Persistence.RequestHandler.flush() given URI not configured for persistence: "+i.path))})},t.prototype.getDB=function(){return this.$db},t.prototype.get=function(t){var e=this;return new Promise(function(i){i(function(t){e.logger.info("get()"),e.isPersistentGetRequest(t);var i=e.$common.clone(t);return!i.hasOwnProperty("data")||e.$common.isEmpty(i.data)?e.$common.clone(e.handleGet(i)):e.$common.clone(e.handleGetStore(i))}(t))})},t.prototype.post=function(t,e){var i=this;return new Promise(function(n){n(function(t,e){i.logger.info("post()"),i.isPostRequest(t);var n=i.$common.clone(t);return i.$common.clone(i.handlePost(n,e))}(t,e))})},t.prototype.put=function(t,e){var i=this;return new Promise(function(n){n(function(t,e){i.logger.info("put()"),i.isPostRequest(t);var n=i.$common.clone(t);return i.$common.clone(i.handlePut(n,e))}(t,e))})},t.prototype.patch=function(t,e){var i=this;return new Promise(function(n){n(function(t,e){i.logger.info("patch()"),i.isPostRequest(t);var n=i.$common.clone(t);return i.$common.clone(i.handlePatch(n,e))}(t,e))})},t.prototype.delete=function(t){var e=this;return new Promise(function(i){i(function(t){e.logger.info("delete()"),e.isPersistentRequest(t);var i=e.$common.clone(t);return e.$common.clone(e.handleDelete(i))}(t))})},t.prototype.data=function(t){var e=this;return new Promise(function(i){i(function(t){if(e.logger.info("data()"),null==t)throw new Error("Path cannot be empty!");var i=e.$options.parseURL(t),n=e.$utils.isPersistUrl(i.path);if(!n)throw new Error("post() given URI not configured for persistence: "+i.path);var r=e.$utils.extractKeyValuesFromUrl2(n);return e.$db.getCollectionByName(r.root)}(t))})},t.prototype.router=function(t,e){var i=this;return void 0===e&&(e=!1),new Promise(function(n){if(!i.isPersistentGetRequest(t))throw i.logger.error("Passed object is not defined request for GET!",t.url),new Error("Passed object is not defined request for GET!");if(!t.hasOwnProperty("method"))throw i.logger.error("request.method was not provided!",t),new Error("request.method was not provided!");var r=i.$common.clone(t);if(r.method=i.$utils._normalizeMethod(r.method),!i[r.method])throw i.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");n(i[r.method](r,e))})},t.prototype._createDatabase=function(t){return new n.DB(this.prefix+"."+this.dbName,this.$options,t)},t}();e.RequestHandler=o},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),s=i(35),a=i(2),u=i(4),c=i(0),l=function(t){function e(e,i){var n=t.call(this,e.statusCode,e.data,e.headers)||this;return n.accessToken=i,n}return r(e,t),e}(a.NetworkResponse);e.AuthenticationResponse=l;var h=function(t){function e(e,i,n){var r=t.call(this,i,n)||this;return r.backend=e,r.utils=i,r.platform=n,r.logger=new o.Logger("MCSAuthorization"),r}return r(e,t),e.prototype.getCurrentUser=function(){return this.platform.invokeService({method:c.HttpMethods.GET,url:this.backend.getPlatformUrl("users/~"),headers:this.backend.getHttpHeaders(),module:c.ModuleNames.AUTHORIZATION}).then(function(t){var e=t.data?new s.User(t.data):null;return{statusCode:t.statusCode,user:e}}.bind(this),function(t){return Promise.reject(t)}.bind(this))},e.prototype._authenticateSuccess=function(t,e){this.logger.info("User logged in "+t.statusCode),this._isAnonymous=!1,this._isAuthorized=!0,this._accessToken=e;for(var i=0;i<this._onAuthenticationCallbacks.length;i++)this._onAuthenticationCallbacks[i](e)},e.prototype.getAuthorizedUserName=function(){throw Error("THis method is not supported by this authorization method.")},e}(u.Authorization);e.MCSAuthorization=h},function(t,e,i){(function(n,r){var o,s,a;s=[],void 0===(a="function"==typeof(o=function(){return function(){"use strict";var t=Object.prototype.hasOwnProperty,e={copyProperties:function(t,e){var i;for(i in t)e[i]=t[i]},resolveTransformObject:function(t,i,n){var r,o;if("number"!=typeof n&&(n=0),++n>=10)return t;for(r in t)"string"==typeof t[r]&&0===t[r].indexOf("[%lktxp]")?(o=t[r].substring(8),i.hasOwnProperty(o)&&(t[r]=i[o])):"object"==typeof t[r]&&(t[r]=e.resolveTransformObject(t[r],i,n));return t},resolveTransformParams:function(t,i){var n,r,o=[];if(void 0===i)return t;for(n=0;n<t.length;n++)r=y(t[n],"shallow-recurse-objects"),o.push(e.resolveTransformObject(r,i));return o}},o={aeq:s,lt:a,gt:u};function s(t,e){var i,n,r,o;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:r=1;break;case!1:r=3;break;case!0:r=4;break;case"":r=5;break;default:r=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==r||9!==o)return r===o}return i=Number(t),n=Number(e),i==i||n==n?i===n:(i=t.toString(),n=e.toString(),i==n)}function a(t,e,i){var n,r,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?i:o<s}return n=Number(t),r=Number(e),n==n&&r==r?n<r||!(n>r)&&i:n==n&&r!=r||(r!=r||n==n)&&(t<e||!(t>e)&&(t==e?i:(n=t.toString(),r=e.toString(),n<r||n==r&&i)))}function u(t,e,i){var n,r,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?i:o>s}return n=Number(t),r=Number(e),n==n&&r==r?n>r||!(n<r)&&i:(n!=n||r==r)&&(r==r&&n!=n||t>e||!(t<e)&&(t==e?i:(n=t.toString(),r=e.toString(),n>r||n==r&&i)))}function c(t,e,i){return o.aeq(t,e)?0:o.lt(t,e,!1)?i?1:-1:o.gt(t,e,!1)?i?-1:1:0}function l(e,i,n,r,o){var s=o||0,a=i[s];if(void 0===e||null===e||!t.call(e,a))return!1;var u=!1,c=e[a];if(s+1>=i.length)u=n(c,r);else if(Array.isArray(c))for(var h=0,d=c.length;h<d&&!0!==(u=l(c[h],i,n,r,s+1));h+=1);else u=l(c,i,n,r,s+1);return u}function h(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(i){return t.call(e,i)}:null}function d(e,i){for(var n in i)if(t.call(i,n))return p[n](e,i[n]);return!1}var p={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return o.aeq(t,e)},$gt:function(t,e){return o.gt(t,e,!1)},$gte:function(t,e){return o.gt(t,e,!0)},$lt:function(t,e){return o.lt(t,e,!1)},$lte:function(t,e){return o.lt(t,e,!0)},$jgt:function(t,e){return t>e},$jgte:function(t,e){return t>=e},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return void 0!==t&&null!==t&&o.gt(t,e[0],!0)&&o.lt(t,e[1],!0)},$jbetween:function(t,e){return void 0!==t&&null!==t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!p.$containsAny(t,e)},$containsAny:function(t,e){var i=h(t);return null!==i&&(Array.isArray(e)?e.some(i):i(e))},$contains:function(t,e){var i=h(t);return null!==i&&(Array.isArray(e)?e.every(i):i(e))},$type:function(t,e){var i=typeof t;return"object"===i&&(Array.isArray(t)?i="array":t instanceof Date&&(i="date")),"object"!=typeof e?i===e:d(i,e)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:d(t.length,e))},$len:function(t,e){return"string"==typeof t&&("object"!=typeof e?t.length===e:d(t.length,e))},$where:function(t,e){return!0===e(t)},$not:function(t,e){return!d(t,e)},$and:function(t,e){for(var i=0,n=e.length;i<n;i+=1)if(!d(t,e[i]))return!1;return!0},$or:function(t,e){for(var i=0,n=e.length;i<n;i+=1)if(d(t,e[i]))return!0;return!1}},f={$eq:p.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function y(t,e){if(null===t||void 0===t)return null;var i,n=e||"parse-stringify";switch(n){case"parse-stringify":i=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":i=jQuery.extend(!0,{},t);break;case"shallow":i=Object.create(t.constructor.prototype),Object.keys(t).map(function(e){i[e]=t[e]});break;case"shallow-assign":i=Object.create(t.constructor.prototype),Object.assign(i,t);break;case"shallow-recurse-objects":i=y(t,"shallow");var r=Object.keys(t);r.forEach(function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name&&(i[e]=y(t[e],"shallow-recurse-objects"))})}return i}function m(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return!1}}function g(){}function v(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]},e&&e.hasOwnProperty("env")?this.ENV=e.env:this.ENV=void 0!==n&&(n.android||n.NSObject)?"NATIVESCRIPT":"undefined"==typeof window?"NODEJS":void 0!==n&&n.window&&r?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function b(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function O(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function _(){try{this.fs=i(11)}catch(t){this.fs=null}}function E(){}function A(t,e){return e=e||{},this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function w(t,e,i){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=i||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new A(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[]}}function C(e,i){this.name=e,this.data=[],this.idIndex=[],this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var n=this;(i=i||{}).hasOwnProperty("unique")&&(Array.isArray(i.unique)||(i.unique=[i.unique]),i.unique.forEach(function(t){n.uniqueNames.push(t),n.constraints.unique[t]=new M(t)})),i.hasOwnProperty("exact")&&i.exact.forEach(function(t){n.constraints.exact[t]=new x(t)}),this.adaptiveBinaryIndices=!i.hasOwnProperty("adaptiveBinaryIndices")||i.adaptiveBinaryIndices,this.transactional=!!i.hasOwnProperty("transactional")&&i.transactional,this.cloneObjects=!!i.hasOwnProperty("clone")&&i.clone,this.cloneMethod=i.hasOwnProperty("cloneMethod")?i.cloneMethod:"parse-stringify",this.asyncListeners=!!i.hasOwnProperty("asyncListeners")&&i.asyncListeners,this.disableMeta=!!i.hasOwnProperty("disableMeta")&&i.disableMeta,this.disableChangesApi=!i.hasOwnProperty("disableChangesApi")||i.disableChangesApi,this.disableDeltaChangesApi=!i.hasOwnProperty("disableDeltaChangesApi")||i.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!i.hasOwnProperty("autoupdate")&&i.autoupdate,this.serializableIndices=!i.hasOwnProperty("serializableIndices")||i.serializableIndices,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(i.ttl||-1,i.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.ensureId();var r=[];if(i&&i.indices)if("[object Array]"===Object.prototype.toString.call(i.indices))r=i.indices;else{if("string"!=typeof i.indices)throw new TypeError("Indices needs to be a string or an array of strings");r=[i.indices]}for(var o=0;o<r.length;o++)this.ensureIndex(r[o]);function s(t,e){var i=null!==e&&"object"==typeof e?Object.keys(e):null;if(i&&i.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var r={},o=0;o<i.length;o++){var a=i[o];if(e.hasOwnProperty(a))if(!t.hasOwnProperty(a)||n.uniqueNames.indexOf(a)>=0||"$loki"==a||"meta"==a)r[a]=e[a];else{var u=s(t[a],e[a]);void 0!==u&&u!={}&&(r[a]=u)}}return 0===Object.keys(r).length?void 0:r}return t===e?void 0:e}function a(){n.changes=[]}this.observerCallback=function(e){var i="function"==typeof Set?new Set:[];i.add||(i.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),e.forEach(function(t){i.add(t.object)}),i.forEach(function(e){if(!t.call(e,"$loki"))return n.removeAutoUpdateObserver(e);try{n.update(e)}catch(t){}})},this.getChangeDelta=function(t,e){return e?s(e,t):JSON.parse(JSON.stringify(t))},this.getObjectDelta=s,this.getChanges=function(){return n.changes},this.flushChanges=a,this.setChangesApi=function(t){n.disableChangesApi=!t,t||(n.disableDeltaChangesApi=!1)},this.on("delete",function(t){n.disableChangesApi||n.createChange(n.name,"R",t)}),this.on("warning",function(t){n.console.warn(t)}),a()}function I(t){return-1!==t.indexOf(".")}function P(t){return parseFloat(t,10)}function S(t,e){return t+e}function F(t,e){return t-e}function D(t){return t.reduce(S,0)/t.length}function T(t,e,i){if(!1===i)return t[e];for(var n=e.split("."),r=t;n.length>0;)r=r[n.shift()];return r}function R(t,e,i){for(var n,r,o=0,s=t.length;o<s;){if(r=o+s>>1,0===(n=i.apply(null,[e,t[r]])))return{found:!0,index:r};n<0?s=r:o=r+1}return{found:!1,index:s}}function N(t){return function(e,i){return R(e,i,t)}}function k(){}function M(t){this.field=t,this.keyMap={},this.lokiMap={}}function x(t){this.index={},this.field=t}return g.prototype.events={},g.prototype.asyncListeners=!1,g.prototype.on=function(t,e){var i,n=this;return Array.isArray(t)?(t.forEach(function(t){n.on(t,e)}),e):((i=this.events[t])||(i=this.events[t]=[]),i.push(e),e)},g.prototype.emit=function(t){var e=this,i=Array.prototype.slice.call(arguments,1);if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].forEach(function(t){e.asyncListeners?setTimeout(function(){t.apply(e,i)},1):t.apply(e,i)})},g.prototype.addListener=g.prototype.on,g.prototype.removeListener=function(t,e){var i=this;if(Array.isArray(t))t.forEach(function(t){i.removeListener(t,e)});else if(this.events[t]){var n=this.events[t];n.splice(n.indexOf(e),1)}},v.prototype=new g,v.prototype.constructor=v,v.prototype.getIndexedAdapter=function(){return i(12)},v.prototype.configureOptions=function(t,e){var i={fs:_,localStorage:E,memory:b};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t){if(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof i[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new i[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null),t.autoload&&e){var n=this;setTimeout(function(){n.loadDatabase(t,t.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new i[this.persistenceMethod]))},v.prototype.copy=function(t){var e,i,n=new v(this.filename,{env:"NA"});if(t=t||{},n.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(n.autosaveHandle=null,n.persistenceAdapter=null,e=n.collections.length,i=0;i<e;i++)n.collections[i].constraints=null,n.collections[i].ttl=null;return n},v.prototype.addCollection=function(t,e){var i,n=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&e.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(i=0;i<n;i+=1)if(this.collections[i].name===t)return this.collections[i];var r=new C(t,e);return this.collections.push(r),this.verbose&&(r.console=console),r},v.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},v.prototype.getCollection=function(t){var e,i=this.collections.length;for(e=0;e<i;e+=1)if(this.collections[e].name===t)return this.collections[e];return this.emit("warning","collection "+t+" not found"),null},v.prototype.renameCollection=function(t,e){var i=this.getCollection(t);return i&&(i.name=e),i},v.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},v.prototype.removeCollection=function(t){var e,i=this.collections.length;for(e=0;e<i;e+=1)if(this.collections[e].name===t){var n=new C(t,{}),r=this.collections[e];for(var o in r)r.hasOwnProperty(o)&&n.hasOwnProperty(o)&&(r[o]=n[o]);return void this.collections.splice(e,1)}},v.prototype.getName=function(){return this.name},v.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return e}},v.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}},v.prototype.toJson=v.prototype.serialize,v.prototype.serializeDestructured=function(t){var e,i,n,r,o,s=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&t.partition>=0)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((o=new v(this.filename)).loadJSONObject(this),e=0;e<o.collections.length;e++)o.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return o.serialize({serializationMethod:"normal"});for(s.push(o.serialize({serializationMethod:"normal"})),o=null,e=0;e<this.collections.length;e++)if(n=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(n))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(r=n.length,i=0;i<r;i++)s.push(n[i]),n[i]=null;s.push("")}else s.push(n);return t.partitioned?(t.delimited,s):t.delimited?(s.push(""),s.join(t.delimiter)):(s.push(""),s)},v.prototype.serializeCollection=function(t){var e,i,n=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,n=[],i=0;i<e;i++)n.push(JSON.stringify(this.collections[t.collectionIndex].data[i]));return t.delimited?(n.push(""),n.join(t.delimiter)):n},v.prototype.deserializeDestructured=function(t,e){var i,n,r,o=[],s=0,a=1,u=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?i=JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(i=JSON.parse(t[0]),n=i.collections.length,s=0;s<n;s++)i.collections[s].data=this.deserializeCollection(t[s+1],e);return i}if(e.delimited){if(o=t.split(e.delimiter),t=null,0===o.length)return null}else o=t;for(i=JSON.parse(o[0]),n=i.collections.length,o[0]=null;!u;)o[a],""===o[a]?++s>n&&(u=!0):(r=JSON.parse(o[a]),i.collections[s].data.push(r)),o[a++]=null;return i},v.prototype.deserializeCollection=function(t,e){var i,n,r=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(r=t.split(e.delimiter)).pop():r=t,n=r.length,i=0;i<n;i++)r[i]=JSON.parse(r[i]);return r},v.prototype.loadJSON=function(t,e){var i;if(0===t.length)i={};else switch(this.options.serializationMethod){case"normal":case"pretty":i=JSON.parse(t);break;case"destructured":i=this.deserializeDestructured(t);break;default:i=JSON.parse(t)}this.loadJSONObject(i,e)},v.prototype.loadJSONObject=function(t,i){var n,r,o,s,a,u,c=0,l=t.collections?t.collections.length:0;function h(t){var n,r=i[t.name];return r.proto?(n=r.inflate||e.copyProperties,function(t){var e=new r.proto;return n(t,e),e}):r.inflate}for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&i&&!i.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];c<l;c+=1){if(n=t.collections[c],(r=this.addCollection(n.name,{disableChangesApi:n.disableChangesApi,disableDeltaChangesApi:n.disableDeltaChangesApi,disableMeta:n.disableMeta})).adaptiveBinaryIndices=!!n.hasOwnProperty("adaptiveBinaryIndices")&&!0===n.adaptiveBinaryIndices,r.transactional=n.transactional,r.asyncListeners=n.asyncListeners,r.cloneObjects=n.cloneObjects,r.cloneMethod=n.cloneMethod||"parse-stringify",r.autoupdate=n.autoupdate,r.changes=n.changes,i&&!0===i.retainDirtyFlags?r.dirty=n.dirty:r.dirty=!1,o=n.data.length,s=0,i&&i.hasOwnProperty(n.name))for(a=h(n);s<o;s++)u=a(n.data[s]),r.data[s]=u,r.addAutoUpdateObserver(u);else for(;s<o;s++)r.data[s]=n.data[s],r.addAutoUpdateObserver(r.data[s]);if(r.maxId=void 0===n.maxId?0:n.maxId,r.idIndex=n.idIndex,void 0!==n.binaryIndices&&(r.binaryIndices=n.binaryIndices),void 0!==n.transforms&&(r.transforms=n.transforms),r.ensureId(),r.uniqueNames=[],n.hasOwnProperty("uniqueNames"))for(r.uniqueNames=n.uniqueNames,s=0;s<r.uniqueNames.length;s++)r.ensureUniqueIndex(r.uniqueNames[s]);if(void 0!==n.DynamicViews){for(var d=0;d<n.DynamicViews.length;d++){var p=n.DynamicViews[d],f=r.addDynamicView(p.name,p.options);f.resultdata=p.resultdata,f.resultsdirty=p.resultsdirty,f.filterPipeline=p.filterPipeline,f.sortCriteria=p.sortCriteria,f.sortFunction=null,f.sortDirty=p.sortDirty,f.resultset.filteredrows=p.resultset.filteredrows,f.resultset.filterInitialized=p.resultset.filterInitialized,f.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(r.ensureAllIndexes(!0),r.dirty=!0)}}},v.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},v.prototype.generateChangesNotification=function(t){function e(t){return t.name}var i=[],n=t||this.collections.map(e);return this.collections.forEach(function(t){-1!==n.indexOf(e(t))&&(i=i.concat(t.getChanges()))}),i},v.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},v.prototype.clearChanges=function(){this.collections.forEach(function(t){t.flushChanges&&t.flushChanges()})},b.prototype.loadDatabase=function(t,e){var i=this;this.options.asyncResponses?setTimeout(function(){i.hashStore.hasOwnProperty(t)?e(i.hashStore[t].value):e(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},b.prototype.saveDatabase=function(t,e,i){var n,r=this;this.options.asyncResponses?setTimeout(function(){n=r.hashStore.hasOwnProperty(t)?r.hashStore[t].savecount:0,r.hashStore[t]={savecount:n+1,lastsave:new Date,value:e},i()},this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:n+1,lastsave:new Date,value:e},i())},b.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},O.prototype.loadDatabase=function(t,e){var i=this;this.dbname=t,this.dbref=new v(t),this.adapter.loadDatabase(t,function(t){if(t){"string"!=typeof t&&e(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var n=JSON.parse(t);i.dbref.loadJSONObject(n),n=null,i.dbref.collections.length,0!==i.dbref.collections.length?(i.pageIterator={collection:0,pageIndex:0},i.loadNextPartition(0,function(){e(i.dbref)})):e(i.dbref)}else e(t)})},O.prototype.loadNextPartition=function(t,e){var i=this.dbname+"."+t,n=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(e);this.adapter.loadDatabase(i,function(i){var r=n.dbref.deserializeCollection(i,{delimited:!0,collectionIndex:t});n.dbref.collections[t].data=r,++t<n.dbref.collections.length?n.loadNextPartition(t,e):e()})},O.prototype.loadNextPage=function(t){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=this;this.adapter.loadDatabase(e,function(e){var n=e.split(i.options.delimiter);e="";var r,o=n.length,s=""===n[o-1];for(s&&(n.pop(),o=n.length,""===n[o-1]&&1===o&&(n.pop(),o=n.length)),r=0;r<o;r++)i.dbref.collections[i.pageIterator.collection].data.push(JSON.parse(n[r])),n[r]=null;n=[],s?++i.pageIterator.collection<i.dbref.collections.length?i.loadNextPartition(i.pageIterator.collection,t):t():(i.pageIterator.pageIndex++,i.loadNextPage(t))})},O.prototype.exportDatabase=function(t,e,i){var n,r=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],n=0;n<r;n++)e.collections[n].dirty&&this.dirtyPartitions.push(n);this.saveNextPartition(function(t){i(t)})},O.prototype.saveNextPartition=function(t){var e=this,i=this.dirtyPartitions.shift(),n=this.dbname+(-1===i?"":"."+i);if(this.options.paging&&-1!==i)return this.pageIterator={collection:i,docIndex:0,pageIndex:0},void this.saveNextPage(function(i){0===e.dirtyPartitions.length?t(i):e.saveNextPartition(t)});var r=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:i});this.adapter.saveDatabase(n,r,function(i){i?t(i):0===e.dirtyPartitions.length?t(null):e.saveNextPartition(t)})},O.prototype.saveNextPage=function(t){var e=this,i=this.dbref.collections[this.pageIterator.collection],n=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,r=0,o=i.data.length,s=this.options.delimiter.length,a="",u="",c=!1,l=!1,h=function(i){u="",i&&t(i),c?t(null):(e.pageIterator.pageIndex++,e.saveNextPage(t))};for(0===i.data.length&&(c=!0);;)if(c||(a=JSON.stringify(i.data[this.pageIterator.docIndex]),u+=a,r+=a.length,++this.pageIterator.docIndex>=o&&(c=!0)),r>=this.options.pageSize&&(l=!0),l&&!c||(u+=this.options.delimiter,r+=s),c||l)return void this.adapter.saveDatabase(n,u,h)},_.prototype.loadDatabase=function(t,e){var i=this;this.fs.stat(t,function(n,r){!n&&r.isFile()?i.fs.readFile(t,{encoding:"utf8"},function(t,i){e(t?new Error(t):i)}):e(null)})},_.prototype.saveDatabase=function(t,e,i){var n=this,r=t+"~";this.fs.writeFile(r,e,function(e){e?i(new Error(e)):n.fs.rename(r,t,i)})},_.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,function(t){t?e(new Error(t)):e()})},E.prototype.loadDatabase=function(t,e){m()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},E.prototype.saveDatabase=function(t,e,i){m()?(localStorage.setItem(t,e),i(null)):i(new Error("localStorage is not available"))},E.prototype.deleteDatabase=function(t,e){m()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},v.prototype.throttledSaveDrain=function(t,e){var i=this,n=(new Date).getTime();if(this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!e.recursiveWait)return void this.throttledCallbacks.push(t);this.throttledCallbacks.push(function(){return i.throttledSavePending?e.recursiveWaitLimit&&n-e.started>e.recursiveWaitLimitDuration?void t(!1):void i.throttledSaveDrain(t,e):void t(!0)})}else t(!0)},v.prototype.loadDatabaseInternal=function(t,e){var i=e||function(t,e){if(t)throw t},n=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(e){if("string"==typeof e){var r=!1;try{n.loadJSON(e,t||{}),r=!0}catch(t){i(t)}r&&(i(null),n.emit("loaded","database "+n.filename+" loaded"))}else{if(!e)return i(null),void n.emit("loaded","empty database "+n.filename+" loaded");if(e instanceof Error)return void i(e);if("object"==typeof e)return n.loadJSONObject(e,t||{}),i(null),void n.emit("loaded","database "+n.filename+" loaded");i("unexpected adapter response : "+e)}}):i(new Error("persistenceAdapter not configured"))},v.prototype.loadDatabase=function(t,e){var i=this;this.throttledSaves?this.throttledSaveDrain(function(n){if(n)return i.throttledSavePending=!0,void i.loadDatabaseInternal(t,function(t){0===i.throttledCallbacks.length?i.throttledSavePending=!1:i.saveDatabase(),"function"==typeof e&&e(t)});"function"==typeof e&&e(new Error("Unable to pause save throttling long enough to read database"))},t):this.loadDatabaseInternal(t,e)},v.prototype.saveDatabaseInternal=function(t){var e=t||function(t){if(t)throw t},i=this;null!==this.persistenceAdapter?"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(t){i.autosaveClearFlags(),e(t)}):(i.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,i.serialize(),function(t){e(t)})):e(new Error("persistenceAdapter not configured"))},v.prototype.saveDatabase=function(t){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(t);else{var e=this.throttledCallbacks;this.throttledCallbacks=[],e.unshift(t),this.throttledSavePending=!0;var i=this;this.saveDatabaseInternal(function(t){i.throttledSavePending=!1,e.forEach(function(e){"function"==typeof e&&setTimeout(function(){e(t)},1)}),i.throttledCallbacks.length>0&&i.saveDatabase()})}else this.saveDatabaseInternal(t)},v.prototype.save=v.prototype.saveDatabase,v.prototype.deleteDatabase=function(t,e){var i=e||function(t,e){if(t)throw t};"function"!=typeof t||e||(i=t),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(t){i(t)}):i(new Error("persistenceAdapter not configured"))},v.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},v.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},v.prototype.autosaveEnable=function(t,e){this.autosave=!0;var i=5e3,n=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(i=this.autosaveInterval),this.autosaveHandle=setInterval(function(){n.autosaveDirty()&&n.saveDatabase(e)},i)},v.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},A.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},A.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},A.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new A(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},A.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new A(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},A.prototype.copy=function(){var t=new A(this.collection);return this.filteredrows.length>0&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},A.prototype.branch=A.prototype.copy,A.prototype.transform=function(t,i){var n,r,o=this;if("string"==typeof t&&this.collection.transforms.hasOwnProperty(t)&&(t=this.collection.transforms[t]),"object"!=typeof t||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==i&&(t=e.resolveTransformParams(t,i)),n=0;n<t.length;n++)switch((r=t[n]).type){case"find":o.find(r.value);break;case"where":o.where(r.value);break;case"simplesort":o.simplesort(r.property,r.desc||r.options);break;case"compoundsort":o.compoundsort(r.value);break;case"sort":o.sort(r.value);break;case"limit":o=o.limit(r.value);break;case"offset":o=o.offset(r.value);break;case"map":o=o.map(r.value,r.dataOptions);break;case"eqJoin":o=o.eqJoin(r.joinData,r.leftJoinKey,r.rightJoinKey,r.mapFun,r.dataOptions);break;case"mapReduce":o=o.mapReduce(r.mapFunction,r.reduceFunction);break;case"update":o.update(r.value);break;case"remove":o.remove()}return o},A.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e,i,n=(e=t,i=this.collection.data,function(t,n){return e(i[t],i[n])});return this.filteredrows.sort(n),this},A.prototype.simplesort=function(t,e){var i,n=10,r=this.collection.data.length,o=this.filteredrows.length,s=this.collection.binaryIndices.hasOwnProperty(t);if(void 0!==e&&!1!==e||(e={desc:!1}),!0===e&&(e={desc:!0}),0===o){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(t))return this.collection.ensureIndex(t),this.filteredrows=this.collection.binaryIndices[t].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&s&&(i=r/o,e.useJavascriptSorting&&(n=6),i<=n||e.forceIndexIntersect)){var a,u=this.filteredrows,l={};for(a=0;a<o;a++)l[u[a]]=!0;var h=this.collection.binaryIndices[t].values;return this.filteredrows=h.filter(function(t){return l[t]}),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort(function(e,i){return e[t]===i[t]?0:e[t]>i[t]?1:e[t]<i[t]?-1:void 0});var d,p,f,y,m,g,v=(d=t,p=e.desc,f=this.collection.data,function(t,e){return~d.indexOf(".")?(g=d.split("."),y=g.reduce(function(t,e){return t&&t[e]||void 0},f[t]),m=g.reduce(function(t,e){return t&&t[e]||void 0},f[e])):(y=f[t][d],m=f[e][d]),c(y,m,p)});return this.filteredrows.sort(v),this},A.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var i=0,n=t.length;i<n;i+=1)e=t[i],Array.isArray(e)||(t[i]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var r,o,s=(r=t,o=this.collection.data,function(t,e){return function(t,e,i){for(var n,r,o,s,a,u=0,l=0,h=t.length;l<h;l++)if(n=t[l],~(r=n[0]).indexOf(".")?(a=r.split("."),o=a.reduce(function(t,e){return t&&t[e]||void 0},e),s=a.reduce(function(t,e){return t&&t[e]||void 0},i)):(o=e[r],s=i[r]),0!==(u=c(o,s,n[1])))return u;return 0}(r,o[t],o[e])});return this.filteredrows.sort(s),this},A.prototype.findOr=function(t){for(var e=null,i=0,n=0,r=[],o=[],s=0,a=this.count(),u=0,c=t.length;u<c;u++){if(e=this.branch().find(t[u]).filteredrows,(n=e.length)===a)return this;for(i=0;i<n;i++)s=e[i],void 0===o[s]&&(o[s]=!0,r.push(s))}return this.filteredrows=r,this.filterInitialized=!0,this},A.prototype.$or=A.prototype.findOr,A.prototype.findAnd=function(t){for(var e=0,i=t.length;e<i;e++){if(0===this.count())return this;this.find(t[e])}return this},A.prototype.$and=A.prototype.findAnd,A.prototype.find=function(e,i){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var n,r,o,s,a,u,c,h=e||"getAll",d=!1,y=[],m=[],g=null;if(i=i||!1,"object"==typeof h){for(n in h)(s={})[n]=h[n],m.push(s),t.call(h,n)&&(r=n,o=h[n]);if(m.length>1)return this.find({$and:m},i)}if(!r||"getAll"===h)return i&&(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0),this;if("$and"===r||"$or"===r)return this[r](o),i&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===o||"object"!=typeof o||o instanceof Date)a="$eq",u=o;else{if("object"!=typeof o)throw new Error("Do not know what you want to do.");for(c in o)if(t.call(o,c)){a=c,u=o[c];break}}"$regex"===a&&(Array.isArray(u)?u=new RegExp(u[0],u[1]):u instanceof RegExp||(u=new RegExp(u)));var v=-1!==r.indexOf("."),b=!v&&!this.filterInitialized;b&&this.collection.binaryIndices[r]&&f[a]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(r),d=!0,g=this.collection.binaryIndices[r]);var O,_=p[a],E=this.collection.data,A=0,w=0,C=0;if(this.filterInitialized)if(O=this.filteredrows,w=O.length,v)for(r=r.split("."),A=0;A<w;A++)C=O[A],l(E[C],r,_,u)&&y.push(C);else for(A=0;A<w;A++)C=O[A],_(E[C][r],u)&&y.push(C);else if(d){var I=this.collection.calculateRange(a,r,u);if("$in"!==a){for(A=I[0];A<=I[1];A++)if(!0!==f[a]){if(f[a](E[g.values[A]][r],u)&&(y.push(g.values[A]),i))return this.filteredrows=y,this.filterInitialized=!0,this}else if(y.push(g.values[A]),i)return this.filteredrows=y,this.filterInitialized=!0,this}else for(A=0,w=I.length;A<w;A++)if(y.push(g.values[I[A]]),i)return this.filteredrows=y,this.filterInitialized=!0,this}else if(w=E.length,v){for(r=r.split("."),A=0;A<w;A++)if(l(E[A],r,_,u)&&(y.push(A),i))return this.filteredrows=y,this.filterInitialized=!0,this}else for(A=0;A<w;A++)if(_(E[A][r],u)&&(y.push(A),i))return this.filteredrows=y,this.filterInitialized=!0,this;return this.filteredrows=y,this.filterInitialized=!0,this},A.prototype.where=function(t){var e,i=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var n=this.filteredrows.length;n--;)!0===e(this.collection.data[this.filteredrows[n]])&&i.push(this.filteredrows[n]);return this.filteredrows=i,this}for(var r=this.collection.data.length;r--;)!0===e(this.collection.data[r])&&i.push(r);return this.filteredrows=i,this.filterInitialized=!0,this}catch(t){throw t}},A.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},A.prototype.data=function(t){var e,i,n,r,o=[],s=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),this.collection.disableDeltaChangesApi||(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(i=s.length,r=t.forceCloneMethod||this.collection.cloneMethod,n=0;n<i;n++)e=y(s[n],r),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);return o}return s.slice()}this.filterInitialized=!0}var a=this.filteredrows;if(i=a.length,this.collection.cloneObjects||t.forceClones)for(r=t.forceCloneMethod||this.collection.cloneMethod,n=0;n<i;n++)e=y(s[a[n]],r),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);else for(n=0;n<i;n++)o.push(s[a[n]]);return o},A.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,i=this.filteredrows.length,n=this.collection.data,r=0;r<i;r++)this.collection.cloneObjects||!this.collection.disableDeltaChangesApi?(e=y(n[this.filteredrows[r]],this.collection.cloneMethod),t(e),this.collection.update(e)):(t(n[this.filteredrows[r]]),this.collection.update(n[this.filteredrows[r]]));return this},A.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},A.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},A.prototype.eqJoin=function(t,e,i,n,r){var o,s,a,u=[],c=[],l=[],h="function"==typeof e,d="function"==typeof i,p={};if(u=this.data(r),o=u.length,t instanceof C)c=t.chain().data(r);else if(t instanceof A)c=t.data(r);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");c=t}s=c.length;for(var f=0;f<s;f++)a=d?i(c[f]):c[f][i],p[a]=c[f];n||(n=function(t,e){return{left:t,right:e}});for(var y=0;y<o;y++)a=h?e(u[y]):u[y][e],l.push(n(u[y],p[a]||{}));return this.collection=new C("joinData"),this.collection.insert(l),this.filteredrows=[],this.filterInitialized=!1,this},A.prototype.map=function(t,e){var i=this.data(e).map(t);return this.collection=new C("mappedData"),this.collection.insert(i),this.filteredrows=[],this.filterInitialized=!1,this},w.prototype=new g,w.prototype.rematerialize=function(t){var e,i,n;if(t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new A(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0),t.hasOwnProperty("removeWhereFilters"))for(e=this.filterPipeline.length,i=e;i--;)"where"===this.filterPipeline[i].type&&(i!==this.filterPipeline.length-1&&(this.filterPipeline[i]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var r=this.filterPipeline;for(this.filterPipeline=[],e=r.length,n=0;n<e;n++)this.applyFind(r[n].val);return this.data(),this.emit("rebuild",this),this},w.prototype.branchResultset=function(t,e){var i=this.resultset.branch();return void 0===t?i:i.transform(t,e)},w.prototype.toJSON=function(){var t=new w(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},w.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===t.queueSortPhase&&this.queueSortPhase()},w.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this},w.prototype.applySimpleSort=function(t,e){return this.sortCriteriaSimple={propname:t,options:e||!1},this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this},w.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this},w.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},w.prototype.commit=function(){return this.cachedresultset=null,this},w.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},w.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,i=this.filterPipeline.length;e<i;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},w.prototype._addFilter=function(t){this.filterPipeline.push(t),this.resultset[t.type](t.val)},w.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline;this.filterPipeline=[];for(var e=0,i=t.length;e<i;e+=1)this._addFilter(t[e]);return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this},w.prototype.applyFilter=function(t){var e=this._indexOfFilterWithId(t.uid);return e>=0?(this.filterPipeline[e]=t,this.reapplyFilters()):(this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this)},w.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},w.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},w.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);return this.filterPipeline.splice(e,1),this.reapplyFilters(),this},w.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},w.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},w.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var t=this;setTimeout(function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))},this.options.minRebuildInterval)}},w.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var t=this;"active"===this.options.sortPriority?setTimeout(function(){t.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent()}},w.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},w.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var i,n=this.resultset.filteredrows,r=e?-1:n.indexOf(+t),o=n.length,s=new A(this.collection);s.filteredrows=[t],s.filterInitialized=!0;for(var a=0,u=this.filterPipeline.length;a<u;a++)i=this.filterPipeline[a],s[i.type](i.val);var c=0===s.filteredrows.length?-1:0;return-1!==r||-1!==c?-1===r&&-1!==c?(n.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==r&&-1===c?(r<o-1?(n.splice(r,1),this.options.persistent&&this.resultdata.splice(r,1)):(n.length=o-1,this.options.persistent&&(this.resultdata.length=o-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==r&&-1!==c?(this.options.persistent&&(this.resultdata[r]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},w.prototype.removeDocument=function(t){var e,i,n,r={},o={},s=[],a=this.resultset,u=this.resultset.filteredrows,c=u.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(t)||(t=[t]),n=t.length,i=0;i<n;i++)r[t[i]]=!0;for(e=0;e<c;e++)r[u[e]]&&(o[e]=!0);Object.keys(o).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(t,e){return!o[e]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(t,e){return!o[e]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var l=function(t){return function(e){return e<a.filteredrows[t]}};for(c=a.filteredrows.length,e=0;e<c;e++)s=t.filter(l(e)),a.filteredrows[e]-=s.length},w.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},C.prototype=new g,C.prototype.createChange=function(t,e,i,n){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(i)):this.getChangeDelta(i,n)})},C.prototype.insertMeta=function(t){var e,i;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,i=0;i<e;i++)t[i].hasOwnProperty("meta")||(t[i].meta={}),t[i].meta.created=(new Date).getTime(),t[i].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},C.prototype.updateMeta=function(t){!this.disableMeta&&t&&(t.meta.updated=(new Date).getTime(),t.meta.revision+=1)},C.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},C.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},C.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},C.prototype.updateMetaWithChange=function(t,e){this.updateMeta(t),this.createUpdateChange(t,e)},C.prototype.console={log:function(){},warn:function(){},error:function(){}},C.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},C.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},C.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},C.prototype.getTransform=function(t){return this.transforms[t]},C.prototype.setTransform=function(t,e){this.transforms[t]=e},C.prototype.removeTransform=function(t){delete this.transforms[t]},C.prototype.byExample=function(t){var e,i,n;for(e in n=[],t)t.hasOwnProperty(e)&&n.push(((i={})[e]=t[e],i));return{$and:n}},C.prototype.findObject=function(t){return this.findOne(this.byExample(t))},C.prototype.findObjects=function(t){return this.find(this.byExample(t))},C.prototype.ttlDaemonFuncGen=function(){var t=this,e=this.ttl.age;return function(){var i=Date.now(),n=t.chain().where(function(t){var n=t.meta.updated||t.meta.created,r=i-n;return e<r});n.remove()}},C.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},C.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),i=0;i<t;i+=1)e[i]=i;return e},C.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},C.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null===t||void 0===t)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[t]||e||this.binaryIndices[t].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(t)||e)){var i={name:t,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[t]=i;var n,r,s,a,u,c=(n=t,r=this.data,function(t,e){if(~n.indexOf(".")?(u=n.split("."),s=u.reduce(function(t,e){return t&&t[e]||void 0},r[t]),a=u.reduce(function(t,e){return t&&t[e]||void 0},r[e])):(s=r[t][n],a=r[e][n]),s!==a){if(o.lt(s,a,!1))return-1;if(o.gt(s,a,!1))return 1}return 0});i.values.sort(c),i.dirty=!1,this.dirty=!0}},C.prototype.checkAllIndexes=function(e){var i,n=this.binaryIndices,r=[];for(i in n)t.call(n,i)&&(this.checkIndex(i,e)||r.push(i));return r},C.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||e.randomSamplingFactor>1)&&(e.randomSamplingFactor=.1);var i,n,r,o,s,a=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),s=this.binaryIndices[t].values,(o=s.length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===o)return!0;if(1===o)a=0===s[0];else if(e.randomSampling){if(p.$lte(this.data[s[0]][t],this.data[s[1]][t])||(a=!1),p.$lte(this.data[s[o-2]][t],this.data[s[o-1]][t])||(a=!1),a)for(n=Math.floor((o-1)*e.randomSamplingFactor),i=0;i<n-1;i++)if(r=Math.floor(Math.random()*(o-1)),!p.$lte(this.data[s[r]][t],this.data[s[r+1]][t])){a=!1;break}}else for(i=0;i<o-1;i++)if(!p.$lte(this.data[s[i]][t],this.data[s[i+1]][t])){a=!1;break}return!a&&e.repair&&this.ensureIndex(t,!0),a},C.prototype.getBinaryIndexValues=function(t){var e,i=this.binaryIndices[t].values,n=[];for(e=0;e<i.length;e++)n.push(this.data[i[e]][t]);return n},C.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new M(t),this.data.forEach(function(t){e.set(t)}),e},C.prototype.ensureAllIndexes=function(e){var i,n=this.binaryIndices;for(i in n)t.call(n,i)&&this.ensureIndex(i,e)},C.prototype.flagBinaryIndexesDirty=function(){var e,i=this.binaryIndices;for(e in i)t.call(i,e)&&(i[e].dirty=!0)},C.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},C.prototype.count=function(t){return t?this.chain().find(t).filteredrows.length:this.data.length},C.prototype.ensureId=function(){var t=this.data.length,e=0;for(this.idIndex=[];e<t;e+=1)this.idIndex.push(this.data[e].$loki)},C.prototype.ensureIdAsync=function(t){this.async(function(){this.ensureId()},t)},C.prototype.addDynamicView=function(t,e){var i=new w(this,t,e);return this.DynamicViews.push(i),i},C.prototype.removeDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].name===t&&this.DynamicViews.splice(e,1)},C.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},C.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},C.prototype.findAndRemove=function(t){this.chain().find(t).remove()},C.prototype.insert=function(t){if(!Array.isArray(t))return this.insertOne(t);var e,i=[];this.emit("pre-insert",t);for(var n=0,r=t.length;n<r;n++){if(!(e=this.insertOne(t[n],!0)))return;i.push(e)}return this.emit("insert",i),1===(i=this.cloneObjects?y(i,this.cloneMethod):i).length?i[0]:i},C.prototype.insertOne=function(t,e){var i,n=null;if("object"!=typeof t?n=new TypeError("Document needs to be an object"):null===t&&(n=new TypeError("Object cannot be null")),null!==n)throw this.emit("error",n),n;var r=this.cloneObjects?y(t,this.cloneMethod):t;if(this.disableMeta||void 0!==r.meta||(r.meta={revision:0,created:0}),e||this.emit("pre-insert",r),this.add(r))return this.disableChangesApi?this.insertMeta(r):this.insertMetaWithChange(r),i=this.cloneObjects?y(r,this.cloneMethod):r,e||this.emit("insert",i),this.addAutoUpdateObserver(i),i},C.prototype.clear=function(t){var e=this;if(t=t||{},this.data=[],this.idIndex=[],this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,!0===t.removeIndices)this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[];else{var i=Object.keys(this.binaryIndices);i.forEach(function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]}),this.constraints={unique:{},exact:{}},this.uniqueNames.forEach(function(t){e.ensureUniqueIndex(t)})}},C.prototype.update=function(e){var i,n,r;if(Array.isArray(e)){r=e.length,(i=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(n=0;n<r;n+=1)this.update(e[n])}finally{i&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!t.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var o,s,a,u,c,l=this.get(e.$loki,!0),h=this;if(!l)throw new Error("Trying to update a document not in collection.");o=l[0],a=l[1],s=this.cloneObjects||!this.disableDeltaChangesApi?y(e,this.cloneMethod):e,this.emit("pre-update",e),Object.keys(this.constraints.unique).forEach(function(t){h.constraints.unique[t].update(o,s)}),this.data[a]=s,s!==e&&this.addAutoUpdateObserver(e);for(var d=0;d<this.DynamicViews.length;d++)this.DynamicViews[d].evaluateDocument(a,!1);if(this.adaptiveBinaryIndices){var p=this.binaryIndices;for(u in p)this.adaptiveBinaryIndexUpdate(a,u)}else this.flagBinaryIndexesDirty();return this.idIndex[a]=s.$loki,this.commit(),this.dirty=!0,this.disableChangesApi?this.updateMeta(s,null):this.updateMetaWithChange(s,o),c=this.cloneObjects?y(s,this.cloneMethod):s,this.emit("update",c,o),c}catch(t){throw this.rollback(),this.console.error(t.message),this.emit("error",t),t}}},C.prototype.add=function(e){if("object"!=typeof e)throw new TypeError("Object being added needs to be an object");if(void 0!==e.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1),e.$loki=this.maxId,this.disableMeta||(e.meta.version=0);var i,n=this.constraints.unique;for(i in n)t.call(n,i)&&n[i].set(e);this.idIndex.push(e.$loki),this.data.push(e);for(var r=this.data.length-1,o=this.DynamicViews.length,s=0;s<o;s++)this.DynamicViews[s].evaluateDocument(r,!0);if(this.adaptiveBinaryIndices){var a=this.binaryIndices;for(i in a)this.adaptiveBinaryIndexInsert(r,i)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?y(e,this.cloneMethod):e}catch(t){throw this.rollback(),this.console.error(t.message),this.emit("error",t),t}},C.prototype.updateWhere=function(t,e){var i,n=this.where(t),r=0;try{for(;r<n.length;r++)i=e(n[r]),this.update(i)}catch(t){this.rollback(),this.console.error(t.message)}},C.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},C.prototype.removeDataOnly=function(){this.remove(this.data.slice())},C.prototype.removeBatchByPositions=function(t){var e,i,n,r=t.length,o={},s=Object.keys(this.binaryIndices).length,a=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;try{for(this.startTransaction(),n=0;n<r;n++)o[this.idIndex[t[n]]]=!0;if((e=this.DynamicViews.length)>0||s>0){if(e>0)for(i=0;i<e;i++)this.DynamicViews[i].removeDocument(t);if(this.adaptiveBinaryIndices&&!a){var u,c=this.binaryIndices;for(u in c)this.adaptiveBinaryIndexRemove(t,u)}else this.flagBinaryIndexesDirty()}if(!this.disableChangesApi||this.events.delete.length>1)for(n=0;n<r;n++)this.emit("delete",this.data[t[n]]);this.data=this.data.filter(function(t){return!o[t.$loki]}),this.idIndex=this.idIndex.filter(function(t){return!o[t]}),this.adaptiveBinaryIndices&&a&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(t){return this.rollback(),a&&(this.adaptiveBinaryIndices=!0),this.console.error(t.message),this.emit("error",t),null}},C.prototype.removeBatch=function(t){var e,i=t.length,n=this.data.length,r={},o=[];for(e=0;e<n;e++)r[this.data[e].$loki]=e;for(e=0;e<i;e++)"object"==typeof t[e]?o.push(r[t[e].$loki]):o.push(r[t[e]]);this.removeBatchByPositions(o)},C.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!t.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var i=this.get(e.$loki,!0),n=i[1],r=this;Object.keys(this.constraints.unique).forEach(function(t){null!==e[t]&&void 0!==e[t]&&r.constraints.unique[t].remove(e[t])});for(var o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(n);if(this.adaptiveBinaryIndices){var s,a=this.binaryIndices;for(s in a)this.adaptiveBinaryIndexRemove(n,s)}else this.flagBinaryIndexesDirty();return this.data.splice(n,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(n,1),this.commit(),this.dirty=!0,this.emit("delete",i[0]),delete e.$loki,delete e.meta,e}catch(t){return this.rollback(),this.console.error(t.message),this.emit("error",t),null}}},C.prototype.get=function(t,e){var i=e||!1,n=this.idIndex,r=n.length-1,o=0,s=o+r>>1;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;n[o]<n[r];)n[s=o+r>>1]<t?o=s+1:r=s;return r===o&&n[o]===t?i?[this.data[o],o]:this.data[o]:null},C.prototype.getBinaryIndexPosition=function(t,e){var i=this.data[t][e],n=this.binaryIndices[e].values,r=this.calculateRange("$eq",e,i);if(0===r[0]&&-1===r[1])return null;for(var o=r[0],s=r[1],a=o;a<=s;a++)if(n[a]===t)return a;return null},C.prototype.adaptiveBinaryIndexInsert=function(t,e){var i=this.binaryIndices[e].values,n=this.data[t][e];!0===this.serializableIndices&&n instanceof Date&&(this.data[t][e]=n.getTime(),n=this.data[t][e]);var r=0===i.length?0:this.calculateRangeStart(e,n,!0);this.binaryIndices[e].values.splice(r,0,t)},C.prototype.adaptiveBinaryIndexUpdate=function(t,e){var i,n=this.binaryIndices[e].values,r=n.length;for(i=0;i<r&&n[i]!==t;i++);this.binaryIndices[e].values.splice(i,1),this.adaptiveBinaryIndexInsert(t,e)},C.prototype.adaptiveBinaryIndexRemove=function(t,e,i){var n,r,o,s,a,u,c,l=this.binaryIndices[e],h={};if(Array.isArray(t)){if(1!==(s=t.length)){for(o=0;o<s;o++)h[t[o]]=!0;if(l.values=l.values.filter(function(t){return!h[t]}),!0===i)return;var d=t.slice();for(d.sort(function(t,e){return t-e}),n=l.values.length,r=0;r<n;r++){for(a=l.values[r],u=0,o=0;o<s&&a>d[o];o++)u++;l.values[r]-=u}return}t=t[0]}if(null===(c=this.getBinaryIndexPosition(t,e)))return null;if(l.values.splice(c,1),!0!==i)for(n=l.values.length,r=0;r<n;r++)l.values[r]>t&&l.values[r]--},C.prototype.calculateRangeStart=function(t,e,i){var n=this.data,r=this.binaryIndices[t].values,s=0,a=r.length-1,u=0;if(0===r.length)return-1;for(n[r[s]][t],n[r[a]][t];s<a;)u=s+a>>1,o.lt(n[r[u]][t],e,!1)?s=u+1:a=u;var c=s;return o.aeq(e,n[r[c]][t])?c:o.lt(e,n[r[c]][t],!1)?i?c:c-1:i?c+1:c},C.prototype.calculateRangeEnd=function(t,e){var i=this.data,n=this.binaryIndices[t].values,r=0,s=n.length-1,a=0;if(0===n.length)return-1;for(i[n[r]][t],i[n[s]][t];r<s;)a=r+s>>1,o.lt(e,i[n[a]][t],!1)?s=a:r=a+1;var u=s;return o.aeq(e,i[n[u]][t])?u:o.gt(e,i[n[u]][t],!1)?u+1:o.aeq(e,i[n[u-1]][t])?u-1:u},C.prototype.calculateRange=function(t,e,i){var n,r,s,a=this.data,u=this.binaryIndices[e].values,c=u.length-1;if(0===a.length)return[0,-1];var l=a[u[0]][e],h=a[u[c]][e];switch(t){case"$eq":case"$aeq":case"$dteq":if(o.lt(i,l,!1)||o.gt(i,h,!1))return[0,-1];break;case"$gt":if(o.gt(i,h,!0))return[0,-1];if(o.gt(l,i,!1))return[0,c];break;case"$gte":if(o.gt(i,h,!1))return[0,-1];if(o.gt(l,i,!0))return[0,c];break;case"$lt":if(o.lt(i,l,!0))return[0,-1];if(o.lt(h,i,!1))return[0,c];break;case"$lte":if(o.lt(i,l,!1))return[0,-1];if(o.lt(h,i,!0))return[0,c];break;case"$between":return o.gt(i[0],h,!1)?[0,-1]:o.lt(i[1],l,!1)?[0,-1]:(n=this.calculateRangeStart(e,i[0]),s=this.calculateRangeEnd(e,i[1]),n<0&&n++,s>c&&s--,o.gt(a[u[n]][e],i[0],!0)||n++,o.lt(a[u[s]][e],i[1],!0)||s--,s<n?[0,-1]:[n,s]);case"$in":for(var d=[],p=[],f=0,y=i.length;f<y;f++)for(var m=this.calculateRange("$eq",e,i[f]),g=m[0];g<=m[1];g++)void 0===d[g]&&(d[g]=!0,p.push(g));return p}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":n=this.calculateRangeStart(e,i),r=a[u[n]][e]}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":s=this.calculateRangeEnd(e,i),a[u[s]][e]}switch(t){case"$eq":case"$aeq":case"$dteq":return o.aeq(r,i)?[n,s]:[0,-1];case"$gt":return o.aeq(a[u[s]][e],i)?[s+1,c]:[s,c];case"$gte":return o.aeq(a[u[n]][e],i)?[n,c]:[n+1,c];case"$lt":return o.aeq(a[u[n]][e],i)?[0,n-1]:[0,n];case"$lte":return o.aeq(a[u[s]][e],i)?[0,s]:[0,s-1];default:return[0,a.length-1]}},C.prototype.by=function(t,e){var i;if(void 0===e)return i=this,function(e){return i.by(t,e)};var n=this.constraints.unique[t].get(e);return this.cloneObjects?y(n,this.cloneMethod):n},C.prototype.findOne=function(t){t=t||{};var e=this.chain().find(t,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?y(e[0],this.cloneMethod):e[0]},C.prototype.chain=function(t,e){var i=new A(this);return void 0===t?i:i.transform(t,e)},C.prototype.find=function(t){return this.chain().find(t).data()},C.prototype.findOneUnindexed=function(t,e){for(var i=this.data.length;i--;)if(this.data[i][t]===e)return this.data[i];return null},C.prototype.startTransaction=function(){if(this.transactional){this.cachedData=y(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},C.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},C.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},C.prototype.async=function(t,e){setTimeout(function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()},0)},C.prototype.where=function(t){return this.chain().where(t).data()},C.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(t){throw t}},C.prototype.eqJoin=function(t,e,i,n,r){return new A(this).eqJoin(t,e,i,n,r)},C.prototype.stages={},C.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},C.prototype.commitLog=[],C.prototype.stage=function(t,e){var i=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=i,i},C.prototype.commitStage=function(t,e){var i,n=this.getStage(t),r=(new Date).getTime();for(i in n)this.update(n[i]),this.commitLog.push({timestamp:r,message:e,data:JSON.parse(JSON.stringify(n[i]))});this.stages[t]={}},C.prototype.no_op=function(){},C.prototype.extract=function(t){for(var e=0,i=this.data.length,n=I(t),r=[];e<i;e+=1)r.push(T(this.data[e],t,n));return r},C.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},C.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},C.prototype.maxRecord=function(t){for(var e,i=0,n=this.data.length,r=I(t),o={index:0,value:void 0};i<n;i+=1)void 0!==e?e<T(this.data[i],t,r)&&(e=T(this.data[i],t,r),o.index=this.data[i].$loki):(e=T(this.data[i],t,r),o.index=this.data[i].$loki);return o.value=e,o},C.prototype.minRecord=function(t){for(var e,i=0,n=this.data.length,r=I(t),o={index:0,value:void 0};i<n;i+=1)void 0!==e?e>T(this.data[i],t,r)&&(e=T(this.data[i],t,r),o.index=this.data[i].$loki):(e=T(this.data[i],t,r),o.index=this.data[i].$loki);return o.value=e,o},C.prototype.extractNumerical=function(t){return this.extract(t).map(P).filter(Number).filter(function(t){return!isNaN(t)})},C.prototype.avg=function(t){return D(this.extractNumerical(t))},C.prototype.stdDev=function(t){return e=this.extractNumerical(t),i=D(e),n=D(e.map(function(t){var e=t-i,n=e*e;return n})),Math.sqrt(n);var e,i,n},C.prototype.mode=function(t){var e,i,n,r={},o=this.extract(t);for(i in o.forEach(function(t){r[t]?r[t]+=1:r[t]=1}),r)e?e<r[i]&&(n=i):(n=i,e=r[i]);return n},C.prototype.median=function(t){var e=this.extractNumerical(t);e.sort(F);var i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2},k.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},setSort:function(t){this.bs=new N(t)},bs:function(){return new N(this.sort)},set:function(t,e){var i=this.bs(this.keys,t);i.found?this.values[i.index]=e:(this.keys.splice(i.index,0,t),this.values.splice(i.index,0,e))},get:function(t){return this.values[R(this.keys,t,this.sort).index]}},M.prototype.keyMap={},M.prototype.lokiMap={},M.prototype.set=function(t){var e=t[this.field];if(null!==e&&void 0!==e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},M.prototype.get=function(t){return this.keyMap[t]},M.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},M.prototype.update=function(t,e){if(this.lokiMap[t.$loki]!==e[this.field]){var i=this.lokiMap[t.$loki];this.set(e),this.keyMap[i]=void 0}else this.keyMap[t[this.field]]=e},M.prototype.remove=function(t){var e=this.keyMap[t];if(null===e||void 0===e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},M.prototype.clear=function(){this.keyMap={},this.lokiMap={}},x.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var i=this.index[t];for(var n in i)i[n]==e&&i.splice(n,1);i.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},v.LokiOps=p,v.Collection=C,v.KeyValueStore=k,v.LokiMemoryAdapter=b,v.LokiPartitioningAdapter=O,v.LokiLocalStorageAdapter=E,v.LokiFsAdapter=_,v.persistenceAdapters={fs:_,localStorage:E},v.aeq=s,v.lt=a,v.gt=u,v.Comparators=o,v}()})?o.apply(e,s):o)||(t.exports=a)}).call(this,i(14),i(13))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=i(8),o=function(){function t(t,e,i){this.name=t,this.$options=e,this.lokiStorageAdapter=i,this._db=null,this.options={autosave:!0,autosaveInterval:500,autoload:!0,adapter:null},this.logger=new n.Logger("DB"),!0!==this.$options.off&&!0!==this.$options.isTest||(this.options={autosave:!1,autosaveInterval:31104e6,autoload:!1,adapter:null}),this.options.adapter=i;var o=this.name||t||this.$options.offlineDBName||"offline";this._db=new r(o,this.options),this._db.loadDatabase()}return t.prototype.getCollectionByName=function(t){var e=this._db.getCollection(t);if(!e){e=this._db.addCollection(t,{clone:!0,disableChangesApi:!0,transactional:!0})}return e},t.prototype.getCollection=function(t){var e=this;return new Promise(function(i){e._db.loadDatabase({},function(){var n=e._db.getCollection(t);if(!n){n=e._db.addCollection(t)}i(n)})})},t.prototype.saveDatabase=function(){this._db.save()},t.prototype.getCollections=function(){return this._db.listCollections()},t.prototype.internalDB=function(){return this._db},t.prototype.close=function(t){this._db.close(t)},t.prototype.flush=function(){var t=this;return new Promise(function(e){for(var i=t.getCollections(),n=0;n<i.length;n++)t.getCollectionByName(i[n].name).removeDataOnly();e(!0)})},t}();e.DB=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.SyncResourceType={item:0,collection:1,file:2}},function(t,e){},function(t,e,i){var n,r,o;r=[],void 0===(o="function"==typeof(n=function(){return function(){function t(t){if(this.app="loki",void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function e(t){this.db=null,this.initializeLokiCatalog(t)}return t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadDatabase=function(t,i){var n=this.app,r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(n,t,function(t){if("function"==typeof i){if(0===t.id)return void i(null);i(t.val)}else console.log(t.val)}):this.catalog=new e(function(e){r.catalog=e,r.loadDatabase(t,i)})},t.prototype.loadKey=t.prototype.loadDatabase,t.prototype.saveDatabase=function(t,i,n){var r=this.app,o=this;function s(t){t&&!0===t.success?n(null):n(new Error("Error saving database"))}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(r,t,i,s):this.catalog=new e(function(e){o.catalog=e,e.setAppKey(r,t,i,s)})},t.prototype.saveKey=t.prototype.saveDatabase,t.prototype.deleteDatabase=function(t,i){var n=this.app,r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(n,t,function(t){var e=t.id;0!==e?r.catalog.deleteAppKey(e,i):"function"==typeof i&&i({success:!0})}):this.catalog=new e(function(e){r.catalog=e,r.deleteDatabase(t,i)})},t.prototype.deleteKey=t.prototype.deleteDatabase,t.prototype.deleteDatabasePartitions=function(t){var e=this;this.getDatabaseList(function(i){i.forEach(function(i){i.startsWith(t)&&e.deleteDatabase(i)})})},t.prototype.getDatabaseList=function(t){var i=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(i,function(e){for(var i=[],n=0;n<e.length;n++)i.push(e[n].key);"function"==typeof t?t(i):i.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){n.catalog=e,n.getDatabaseList(t)})},t.prototype.getKeyList=t.prototype.getDatabaseList,t.prototype.getCatalogSummary=function(t){this.app;var i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys(function(e){for(var i,n,r,o,s,a=[],u=0;u<e.length;u++)i=e[u],r=i.app||"",o=i.key||"",s=i.val||"",n=2*r.length+2*o.length+s.length+1,a.push({app:i.app,key:i.key,size:n});"function"==typeof t?t(a):a.forEach(function(t){console.log(t)})}):this.catalog=new e(function(e){i.catalog=e,i.getCatalogSummary(t)})},e.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),i=this;e.onupgradeneeded=function(t){var e=t.target.result;if(e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),!e.objectStoreNames.contains("LokiAKV")){var i=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});i.createIndex("app","app",{unique:!1}),i.createIndex("key","key",{unique:!1}),i.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=function(e){i.db=e.target.result,"function"==typeof t&&t(i)},e.onerror=function(t){throw t}},e.prototype.getAppKey=function(t,e,i){var n,r,o=this.db.transaction(["LokiAKV"],"readonly"),s=o.objectStore("LokiAKV"),a=s.index("appkey"),u=t+","+e,c=a.get(u);c.onsuccess=(n=i,function(t){var e=t.target.result;null!==e&&void 0!==e||(e={id:0,success:!1}),"function"==typeof n?n(e):console.log(e)}),c.onerror=(r=i,function(t){if("function"!=typeof r)throw t;r({id:0,success:!1})})},e.prototype.getAppKeyById=function(t,e,i){var n,r,o=this.db.transaction(["LokiAKV"],"readonly"),s=o.objectStore("LokiAKV"),a=s.get(t);a.onsuccess=(n=i,r=e,function(t){"function"==typeof r?r(t.target.result,n):console.log(t.target.result)})},e.prototype.setAppKey=function(t,e,i,n){var r,o=this.db.transaction(["LokiAKV"],"readwrite"),s=o.objectStore("LokiAKV"),a=s.index("appkey"),u=t+","+e,c=a.get(u);c.onsuccess=function(r){var o=r.target.result;null===o||void 0===o?o={app:t,key:e,appkey:t+","+e,val:i}:o.val=i;var a,u,l=s.put(o);l.onerror=(a=n,function(t){"function"==typeof a?a({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(c.error))}),l.onsuccess=(u=n,function(t){"function"==typeof u&&u({success:!0})})},c.onerror=(r=n,function(t){"function"==typeof r?r({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(c.error))})},e.prototype.deleteAppKey=function(t,e){var i,n,r=this.db.transaction(["LokiAKV"],"readwrite"),o=r.objectStore("LokiAKV"),s=o.delete(t);s.onsuccess=(i=e,function(t){"function"==typeof i&&i({success:!0})}),s.onerror=(n=e,function(t){"function"==typeof n?n({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(s.error))})},e.prototype.getAppKeys=function(t,e){var i,n,r,o=this.db.transaction(["LokiAKV"],"readonly"),s=o.objectStore("LokiAKV"),a=s.index("app"),u=IDBKeyRange.only(t),c=a.openCursor(u);c.onsuccess=(i=[],n=e,function(t){var e=t.target.result;if(e){var r=e.value;i.push(r),e.continue()}else"function"==typeof n?n(i):console.log(i)}),c.onerror=(r=e,function(t){"function"==typeof r?r(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},e.prototype.getAllKeys=function(t){var e,i,n,r=this.db.transaction(["LokiAKV"],"readonly"),o=r.objectStore("LokiAKV"),s=o.openCursor();s.onsuccess=(e=[],i=t,function(t){var n=t.target.result;if(n){var r=n.value;e.push(r),n.continue()}else"function"==typeof i?i(e):console.log(e)}),s.onerror=(n=t,function(t){"function"==typeof n&&n(null)})},t}()})?n.apply(e,r):n)||(t.exports=o)},function(t,e){var i,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var u,c=[],l=!1,h=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&p())}function p(){if(!l){var t=a(d);l=!0;for(var e=c.length;e;){for(u=c,c=[];++h<e;)u&&u[h].run();h=-1,e=c.length}u=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=y,r.addListener=y,r.once=y,r.off=y,r.removeListener=y,r.removeAllListeners=y,r.emit=y,r.prependListener=y,r.prependOnceListener=y,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,i,n,r){return t.call(this,"mcs-request",e,i,n,r)||this}return r(e,t),e.prototype.buildResponseObject=function(t){return t},e.prototype.getResponsePayload=function(t){return t.data},e.prototype.getModuleName=function(){return"MCS"},e.prototype.isPersistentGetRequest=function(i){t.prototype.isPersistentGetRequest.call(this,i);var n=e.HEADER_RESOURCE_TYPE in i||i.headers[e.HEADER_RESOURCE_TYPE];if("collection"===n){if(this.$common.isEmpty(i.data))throw new Error("cannot proceed with empty payload");if(!("items"in i.data))throw new Error("items is not in the payload returned from MCS, probably not Sync Custom Code");if(!("uris"in i.data))throw new Error("url is not in the payload returned from MCS, probably not Sync Custom Code");if(!("etags"in i.data))throw new Error("etags is not in the payload returned from MCS, probably not Sync Custom Code")}else if("item"!==n)throw new Error("oracle-mobile-sync-resource-type is not in the headers returned from MCS, probably not Sync Custom Code");return!0},e.prototype.handleMcsGetCollectionPayload=function(t,i){for(var n=t.items,r=Date.now(),o=0;o<n.length;o++){var s=n[o];s[e.URI_KEY]=this.normalizeURI(t.uris[o]),s[e.ETAG_KEY]=t.etags[o];var a=s[e.URI_KEY],u=this.collectionFindOneByUri(i,a);u?(this.$common.extendOwn(u,s),i.update(u)):i.insert(s)}return i.removeWhere(function(t){return(t.meta.updated||t.meta.created)<r}),i.find()},e.prototype.handleMcsGetItemPayload=function(t,i,n){var r=this.collectionFindOneByUri(t,n);if(r){var o=i;return this.$common.extendOwn(r,o),t.update(r)}return(o=i)[e.URI_KEY]=n,t.insert(o)},e.prototype.handleGet=function(t){var i=this.$options.isPersistentUrl(t.url);if(!1===i)throw new Error("Persistence.handleMcsGet()-> URI was not configured for persistence:"+t.url);var n=this.$db.getCollectionByName(i.root);if(this.$common.isEmpty(i.params)){var r=n.find(),o={items:[],uris:[],etags:[]};for(var s in r){r[s].hasOwnProperty(e.URI_KEY)&&(o.uris.push(r[s][e.URI_KEY]),delete r[s][e.URI_KEY]),r[s].hasOwnProperty(e.ETAG_KEY)&&(o.etags.push(r[s][e.ETAG_KEY]),delete r[s][e.ETAG_KEY]);var a=this.$common.cleanObject(r[s]);o.items.push(a)}return o}var u=this.collectionFindOneByPersistentPath(n,i);return this.$common.cleanObject(u)},e.prototype.handleGetStore=function(t){var i=this.$options.isPersistentUrl(t.url);if(!1===i)throw new Error("Persistence.handleMcsGetStore()-> URI was not configured for persistence:"+t.url);var n=this.$db.getCollectionByName(i.root),r=t.data,o=e.HEADER_RESOURCE_TYPE in t||t.headers[e.HEADER_RESOURCE_TYPE];if("collection"===o)return this.handleMcsGetCollectionPayload(r,n);if("item"===o)return this.handleMcsGetItemPayload(n,r,i.path);throw o?(this.logger.error("unknown Oracle-Mobile-Sync-Resource-Type (%s)",o),new Error("unknown Oracle-Mobile-Sync-Resource-Type")):(this.logger.error("this is not MCS response, unable to handle the payload, no MCS header was specified: ",t),new Error("this is not MCS response, unable to handle the payload, no MCS header was specified"))},e.prototype.handlePost=function(t,i){var n=this.$options.isPersistentUrl(t.url);if(!1===n)throw new Error("Persistence.handleMcsPost()-> URI was not configured for persistence:"+t.url);var r=this.$db.getCollectionByName(n.root),o=t.data;if(!this.$common.isEmpty(n.params))throw new Error("you can add new objects only against the root REST resource endpoint");if(this.$common.isArray(o))throw new Error("the payload cannot be array");if(this.$common.isObject(o)&&!this.$common.isNull(o)&&!this.$common.isFunction(o)){if(t.data&&t.data[e.URI_KEY])return this.updatePayloadWithNewUri(r,t);var s=null;t&&t.headers&&t.headers[e.HEADER_LOCATION]&&(s=this.$common.stringStartsWith(t.headers[e.HEADER_LOCATION],"/")?t.headers[e.HEADER_LOCATION]:"/"+t.headers[e.HEADER_LOCATION]);var a=null;if(s&&(a=this.collectionFindOneByUri(r,s)),a?this.$common.extendOwn(a,t.data):(o[e.ETAG_KEY]='"0-1B2M2Y8AsgTpgAmY7PhCfg"',a=r.insert(o),this.markObjAsOfflineIfForced(a,i)),!s){var u=n.tokens.length>0&&/^\w+$/.test(n.tokens[0].name)?n.tokens[0].name:null,c=null;u&&(c=t.data.hasOwnProperty(u)?t.data[u]:this.$common.getUID()),s=null===c?n.root+"/"+this.$common.getUID():n.root+"/"+c}return a[e.URI_KEY]=s,r.update(a)}throw new Error("don't know what to do with the payload")},e.prototype.updatePayloadWithNewUri=function(t,i){var n=i.data[e.URI_KEY],r=this.collectionFindOneByUri(t,n);if(r)return this.$common.extendOwn(r,i.data),r[e.URI_KEY]=this.normalizeURI(i.headers[e.HEADER_LOCATION]),t.update(r);throw new Error("the payload was not found in collection:"+n)},e.prototype.handlePut=function(t,e){var i=this.$options.isPersistentUrl(t.url);if(!1===i)throw new Error("Persistence.handleMcsPut()-> URI was not configured for persistence:"+t.url);var n=this.$db.getCollectionByName(i.root),r=t.data;if(!this.$common.isEmpty(i.params)){if(this.$common.isArray(r))throw new Error("the payload cannot be array");if(this.$common.isObject(r)&&!this.$common.isNull(r)&&!this.$common.isFunction(r)){var o=this.collectionFindOneByPersistentPath(n,i);if(o)return this.$common.extendOwn(o,r),this.markObjAsOfflineIfForced(o,e),n.update(o)}}throw new Error("you can execute update operations only against existing items in the offline database!")},e.prototype.collectionFindOneByPersistentPath=function(t,i){var n=i.path+"$",r={};return r[e.URI_KEY]={$regex:new RegExp(n)},t.findOne(r)},e.prototype.collectionFindOneByUri=function(t,i){var n={};return n[e.URI_KEY]=i,t.findOne(n)},e.prototype.handleDelete=function(t){var e=this.$options.isPersistentUrl(t.url);if(!1===e)throw new Error("Persistence.handleMcsDelete()-> URI was not configured for persistence:"+t.url);var i=this.$db.getCollectionByName(e.root);if(!this.$common.isEmpty(e.params)){var n=this.collectionFindOneByPersistentPath(i,e);if(n)return i.remove(n);throw new Error("unable to find object with the given ID("+e.path+") in the database")}},e.prototype.postSuccessOperations=function(t){if("POST"===t.syncObj.method){var i=this.$common.clone(t),n=this.$options.parseURL(i.syncObj.url),r=this.$utils.isPersistUrl(n.path);if(!1===r)return this.logger.debug("sync post success operation exist"),t;var o=this.$utils.extractKeyValuesFromUrl2(r),s=this.$db.getCollectionByName(o.root),a=i.syncObj.data,u=i.response;if(this.$common.isArray(a))return this.logger.error("The payload cannot be array"),t;if(this.$common.isObject(a)&&!this.$common.isNull(a)&&!this.$common.isFunction(a)){if(u.data&&u.data[e.URI_KEY])return this.updatePayloadWithNewUri(s,u);var c=null;if(i.headers){var l=this.$utils.parseResponseHeaders(i.headers);if(l[e.HEADER_LOCATION]){var h=l[e.HEADER_LOCATION];c=this.normalizeURI(h)}}var d=a[e.URI_KEY],p=this.collectionFindOneByUri(s,d);if(p?this.$common.extendOwn(p,u.data):(a[e.ETAG_KEY]='"0-1B2M2Y8AsgTpgAmY7PhCfg"',p=s.insert(a)),!c){var f=r.uri.tokens.length>0&&/^\w+$/.test(r.uri.tokens[0].name)?r.uri.tokens[0].name:null,y=null;f&&(y=u.data.hasOwnProperty(f)?u.data[f]:this.$common.getUID()),c=null===y?r.root+"/"+this.$common.getUID():r.root+"/"+y}return p[e.URI_KEY]=c,s.update(p)}}return t},e.prototype.normalizeURI=function(t){return this.$common.stringStartsWith(t,"/")||this.$common.stringStartsWith(t,"http")?t:"/"+t},e.prototype.data=function(t){return new Promise(function(e){return e(function(t){var e=this.$options.isPersistentUrl(t);if(!e)throw new Error("Persistence.BaseModule.data() given URI not configured for persistence: "+t);return this.$db.getCollectionByName(e.root)}(t))})},e.prototype.router=function(t,e){var i=this;return void 0===e&&(e=!1),new Promise(function(n){if(!i.$common.isObject(t))throw console.error("Passed object is not defined request!",t),new Error("Passed object is not defined request!");if(!t.hasOwnProperty("method"))throw i.logger.error("request.method was not provided!",t),new Error("request.method was not provided!");var r=i.$common.clone(t);if(r.method=i.$utils._normalizeMethod(r.method),!i[r.method])throw i.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");n(i[r.method](r,e))})},e.prototype.get=function(t){var e=this;return new Promise(function(i){i(function(t){e.logger.info("get()"),e.isPersistentRequest(t);var i=e.$common.clone(t);return!i.hasOwnProperty("data")||e.$common.isEmpty(i.data)?e.$common.clone(e.handleGet(i)):(e.isPersistentGetRequest(t),e.$common.clone(e.handleGetStore(i)))}(t))})},e.URI_KEY="$mcs$mcsPersistenceURI",e.ETAG_KEY="$mcs$etag",e.HEADER_LOCATION="location",e.HEADER_RESOURCE_TYPE="oracle-mobile-sync-resource-type",e}(i(6).RequestHandler);e.McsRequestHandler=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.endpoint=t,this.uri=e}return t.prototype._getEndpoint=function(){return this.endpoint},t.prototype._getMcsId=function(){return this.uri?this.uri.substring(this.uri.lastIndexOf("/")+1,this.uri.length):null},t.prototype._getMcsURI=function(){return this.uri},t}();e.MobileResource=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=function(){function t(t,e){this.storageCollection=t,e&&(this.id=e.id,this.name=e.name,this.contentLength=e.contentLength,this.contentType=e.contentType,this._eTag=e.eTag,this.createdBy=e.createdBy,this.createdOn=e.createdOn,this.modifiedBy=e.modifiedBy,this.modifiedOn=e.modifiedOn)}return t.prototype.getPayload=function(){return this.contentType===n.ContentTypes.APPLICATION_JSON?JSON.parse(this._payload):this._payload},t.prototype.setPayload=function(t){this.contentType===n.ContentTypes.APPLICATION_JSON&&"object"==typeof t?this._payload=JSON.stringify(t):this._payload=t,this.contentLength=this._payload.length},t.prototype.getstorageCollection=function(){return this.storageCollection},t.prototype.getStorage=function(){return this.storageCollection.getStorage()},t.prototype.loadPayload=function(t,e){this.contentType=e,this.setPayload(t)},t.prototype.setDisplayName=function(t){this.name=t},t.prototype.getDisplayName=function(){return this.name},t.prototype.readPayload=function(t){var e=this;return this.getPayload()?Promise.resolve(this):this.storageCollection.loadObjectPayload(this.id,t).then(function(t){return e.contentType=t.headers[n.Headers.CONTENT_TYPE.toLowerCase()],e.name=decodeURI(t.headers[n.Headers.ORACLE_MOBILE_NAME.toLowerCase()]),e._eTag=t.headers[n.Headers.E_TAG.toLowerCase()],e.createdBy=t.headers[n.Headers.ORACLE_MOBILE_CREATED_BY.toLowerCase()],e.createdOn=t.headers[n.Headers.ORACLE_MOBILE_CREATED_ON.toLowerCase()],e.modifiedBy=t.headers[n.Headers.ORACLE_MOBILE_MODIFIED_BY.toLowerCase()],e.modifiedOn=t.headers[n.Headers.ORACLE_MOBILE_MODIFIED_ON.toLowerCase()],e.setPayload(t.data),e})},t}();e.StorageObject=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t){this.name=null,this.timestamp=(new Date).toISOString(),this.sessionID=null,this.properties={},this.name=t}}();e.AnalyticsEvent=n},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),r=i(2),o=function(){function t(t,e,i){this._logHTTP=!1,this._queryRegex=/\?/,this._deviceState="undefined"!=typeof deviceState?deviceState.unrestricted:null,this._deviceStateChangedCallbacks=[],this.ANDROID_OS_NAME="",this.IOS_OS_NAME="",this._logHTTP=void 0!==t.logHTTP&&t.logHTTP,this._config=t,this._utils=e,this._deviceId=e.uuid(),this._logger=i}return t.prototype.initGPSLocation=function(){},t.prototype.getDeviceId=function(){return this._deviceId},t.prototype.setDeviceState=function(t){if(this._deviceState!==t){this._logger.info("Device state changing from "+this._deviceState+" to "+t),this._deviceState=t;for(var e=0,i=this._deviceStateChangedCallbacks;e<i.length;e++){(0,i[e])(this._deviceState)}}},t.prototype.getGPSLocation=function(){return{latitude:null,longitude:null}},t.prototype.getDeviceInformation=function(){return{model:"<unknown>",manufacturer:"<unknown>",osName:"<unknown>",osVersion:"<unknown>",osBuild:"<unknown>",carrier:"<unknown>"}},t.prototype.invokeService=function(t){var e=t.url;return this.isBrowser&&(e=e+(this._queryRegex.test(e)?"&":"?")+"_="+(new Date).getTime()),new Promise(function(i,o){var s=this,a=new XMLHttpRequest;for(var u in a.open(t.method,e),t.headers)t.headers.hasOwnProperty(u)&&a.setRequestHeader(u,t.headers[u]);if(this._setRequestHeaders(a,t),a.withCredentials=!t.hasOwnProperty("withCredentials")||"boolean"!=typeof t.withCredentials||t.withCredentials,a.responseType=t.responseType||n.XMLHttpRequestResponseTypes.JSON,a.onreadystatechange=function(){if(4===a.readyState){var e=""===a.responseType||"text"===a.responseType?a.responseText:a.response,n=a.responseHeaders?s._utils.normalizeHeaderKeys(a.responseHeaders):s._utils.parseHeaders(a.getAllResponseHeaders()),u=new r.NetworkResponse(a.status,e,n);if(s._logHTTP){var c={headers:n,body:e};s._logger.debug("Received "+t.method+" response from "+t.url,c)}a.status>=200&&a.status<=299?i(u):o(u)}},a.send(t.data),this._logHTTP){var c={headers:t.headers,body:t.data};this._logger.debug("Sent "+t.method+" request to "+t.url,c)}}.bind(this))},t.prototype._setRequestHeaders=function(t,e){t.setRequestHeader(n.Headers.ORACLE_MOBILE_CLIENT_SDK_INFO,this.getClientSDKInfoHeader(e.module))},t.prototype.getClientSDKInfoHeader=function(t){var e=this._getPlatform();return e+=" "+(this._config.mcsVersion||"Unknown"),e+=" ["+t+"]"},t}();e.Platform=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e){this.statusCode=0,this.storageObject=null,this.statusCode=t,this.storageObject=e}}();e.NetworkStorageObject=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(17),r=i(22),o=i(0),s=function(){function t(t,e,i,n,r,o,s){this.userIsolated=i,this.backend=n,this.utils=r,this.logger=o,this.platform=s,this.storage=n.storage,this.userId=r.validateConfiguration(e),this.id=r.validateConfiguration(t)}return t.prototype.getDescription=function(){return this.data?this.data.description:(this.logger.warn("Collection metadata was not loaded yet, please use StorageCollection.loadMetadata to load metadata."),null)},t.prototype.getUserIsolated=function(){return this.data?this.data.userIsolated:this.userIsolated},t.prototype.getStorage=function(){return this.storage},t.prototype.getUserId=function(){return this.userId},t.prototype.getData=function(){return this.data},t.prototype.toJSON=function(){return{id:this.id,description:this.getDescription(),userId:this.getUserId(),userIsolated:this.getUserIsolated(),data:this.getData()}},t.prototype.loadMetadata=function(){var t=this.backend.getHttpHeaders();return t.add(o.Headers.ACCEPT,o.ContentTypes.APPLICATION_JSON),this.platform.invokeService({headers:t,method:o.HttpMethods.GET,url:this.backend.getPlatformUrl("storage/collections/"+this.id),module:o.ModuleNames.STORAGE}).then(function(t){return this.data=t.data,this}.bind(this))},t.prototype.getObjects=function(t,e,i){var r=this.backend.getHttpHeaders();r.add(o.Headers.ACCEPT,o.ContentTypes.APPLICATION_JSON);var s="storage/collections/"+this.id+"/objects";return null!=t&&(s+=-1==s.indexOf("?")?"?":"&",s+="offset="+t),null!=e&&(s+=-1==s.indexOf("?")?"?":"&",s+="limit="+e),this.getUserIsolated()&&i?(s+=-1==s.indexOf("?")?"?":"&",s+="user=*"):this.getUserIsolated()&&this.getUserId()&&(s+=-1==s.indexOf("?")?"?":"&",s+="user="+this.getUserId()),this.platform.invokeService({headers:r,method:o.HttpMethods.GET,url:this.backend.getPlatformUrl(s),module:o.ModuleNames.STORAGE}).then(function(t){for(var e=[],i=t.data,r=0;r<i.items.length;r++)e[e.length]=new n.StorageObject(this,i.items[r]);return e}.bind(this))},t.prototype.getObject=function(t,e){var i=new n.StorageObject(this,this.backend);return i.id=t,i.readPayload(e).then(function(){return i})},t.prototype.loadObjectPayload=function(t,e){var i=this.backend.getHttpHeaders(),n="storage/collections/"+this.id+"/objects/"+t;return null!=this.userId&&this.getUserIsolated()&&(n+="?user="+this.userId),this.platform.invokeService({headers:i,method:o.HttpMethods.GET,url:this.backend.getPlatformUrl(n),responseType:e||o.XMLHttpRequestResponseTypes.JSON,module:o.ModuleNames.STORAGE})},t.prototype.postObject=function(t){return this._postOrPutStorageObject(t,!0)},t.prototype.putObject=function(t){return this._postOrPutStorageObject(t,!1)},t.prototype._postOrPutStorageObject=function(t,e){var i=this.backend.getHttpHeaders();i.add(o.Headers.ORACLE_MOBILE_NAME,encodeURI(t.getDisplayName())),i.add(o.Headers.CONTENT_TYPE,t.contentType);var s="storage/collections/"+this.id+"/objects";return e||(s+="/"+t.id,null!=t._eTag&&i.add(o.Headers.IF_MATCH,t._eTag)),this.getUserIsolated()&&this.getUserId()&&(s+="?user="+this.getUserId()),this.platform.invokeService({headers:i,method:e?o.HttpMethods.POST:o.HttpMethods.PUT,url:this.backend.getPlatformUrl(s),data:t._payload,module:o.ModuleNames.STORAGE}).then(function(t){var e=new n.StorageObject(this,t.data);return new r.NetworkStorageObject(t.statusCode,e)}.bind(this))},t.prototype.contains=function(t){var e=this.backend.getHttpHeaders(),i="storage/collections/"+this.id+"/objects/"+t;return this.getUserIsolated()&&this.getUserId()&&(i+="?user="+this.getUserId()),this.platform.invokeService({headers:e,method:o.HttpMethods.HEAD,url:this.backend.getPlatformUrl(i),module:o.ModuleNames.STORAGE})},t.prototype.deleteObject=function(t){var e=this.backend.getHttpHeaders();e.add(o.Headers.IF_MATCH,"*");var i="storage/collections/"+this.id+"/objects/"+t;return this.getUserIsolated()&&this.getUserId()&&(i+="?user="+this.getUserId()),this.platform.invokeService({headers:e,method:o.HttpMethods.DELETE,url:this.backend.getPlatformUrl(i),module:o.ModuleNames.STORAGE})},t}();e.StorageCollection=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=i(23),o=function(){function t(t,e,i){this.backend=t,this.utils=e,this.platform=i,this.logger=new n.Logger("Storage")}return t.prototype.getCollection=function(t,e,i,n){var o=new r.StorageCollection(t,e,i,this.backend,this.utils,this.logger,this.platform);return n?Promise.resolve(o):o.loadMetadata()},t}();e.Storage=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(3),r=function(){function t(t,e){this.endpoint=t,this.json=e,this._fetchFromService=!1,this._offset=-1,this._limit=-1,this._fetchAll=!1,this._withParams={},this._withHeaders=new n.Dictionary([])}return t.prototype.execute=function(){return this.endpoint._executeFetchObjects(this._withHeaders,this._withParams,this._fetchAll,this._offset,this._limit,this._fetchFromService)},t}();e.FetchCollectionBuilder=r},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(16),s=i(10),a=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._type=s.SyncResourceType.item,n._objects=[],n}return r(e,t),e.prototype.initialize=function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];this._objects.push(i)}return this},e.prototype.getLength=function(){return this._objects.length},e.prototype.getItem=function(t){return this._objects[t]},e.prototype.all=function(){return this._objects},e.prototype.forEach=function(t){this._objects.forEach(t)},e}(o.MobileResource);e.MobileObjectCollection=a},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=i(0),a=i(3),u=function(t){function e(e,i,n,r,o,s,a){return t.call(this,e,i,n,!1,o,r,a,s)||this}return r(e,t),e.prototype.performRequest=function(t){var e=this.getHttpHeaders(new a.Dictionary([]));return this.platform.invokeService({url:t,headers:e,method:s.HttpMethods.DELETE,module:s.ModuleNames.SYNC})},e}(o.SyncProcessor);e.DeleteProcessor=u},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=i(0),a=function(t){function e(e,i,n,r,o,s,a){return t.call(this,e,i,n,!1,o,r,a,s)||this}return r(e,t),e.prototype.performRequest=function(t,e,i){var n=this,r=this.getHttpHeaders(e);return this.platform.invokeService({url:t,headers:r,method:s.HttpMethods.PUT,data:i,module:s.ModuleNames.SYNC}).then(function(e){return{uri:n.getUri(e,t),data:e.data}})},e}(o.SyncProcessor);e.PutProcessor=a},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=i(0),a=function(t){function e(e,i,n,r,o,s,a){return t.call(this,e,i,n,!1,o,r,a,s)||this}return r(e,t),e.prototype.performRequest=function(t,e,i){var n=this,r=this.getHttpHeaders(e);return this.platform.invokeService({url:t,headers:r,method:s.HttpMethods.POST,data:i,module:s.ModuleNames.SYNC}).then(function(e){return{uri:n.getUri(e,t),data:e.data}})},e}(o.SyncProcessor);e.PostProcessor=a},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),s=i(0),a=function(t){function e(e,i,n,r,o,s,a){return t.call(this,e,i,n,!1,o,r,a,s)||this}return r(e,t),e.prototype.performRequest=function(t,e,i){var n=this.getHttpHeaders(e);return this.platform.invokeService({url:t,headers:n,method:s.HttpMethods.GET,module:s.ModuleNames.SYNC}).then(function(e){return{uri:this.getUri(e,t),data:e.data}}.bind(this))},e}(o.SyncProcessor);e.GetProcessor=a},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(10),s=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n._type=o.SyncResourceType.item,n}return r(e,t),e.prototype._assign=function(t){return void 0===t&&(t={}),t.__proto__=this,t},e.prototype.save=function(t){return this._getEndpoint()._save(this,t)},e.prototype.delete=function(){return this._getEndpoint()._delete(this)},e}(i(16).MobileResource);e.MobileObject=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(31),r=i(30),o=i(29),s=i(28),a=i(27),u=i(26),c=i(25),l=i(2),h=i(0),d=i(3),p=function(){function t(t,e,i,n,r,o,s,a){var u=this;this.backend=n,this.utils=r,this.platform=o,this.common=s,this.options=a,this.purge=function(){u.options.module.flush(u.backend.getCustomCodeUrl(u.apiName+"/"+u.endpointPath))},this.synchronization=t,this.apiName=e,this.endpointPath=i}return t.prototype.createObject=function(t){return void 0===t&&(t={}),new n.MobileObject(this,null)._assign(t)},t.prototype.fetchObject=function(t,e){var i=this.apiName;this.endpointPath&&this.endpointPath.length>0&&(i+="/"+this.endpointPath),t&&""!==t&&(i+="/"+t),i=this.backend.getCustomCodeUrl(i);var o=new r.GetProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),s=new d.Dictionary([]);return s.add(h.Headers.ACCEPT,h.ContentTypes.APPLICATION_JSON),o.performRequest(i,s,e).then(function(t){{if(t.data&&""!==t.data){var e=t.data;return"string"==typeof e&&(e=""!==e?JSON.parse(e):null),new n.MobileObject(this,t.uri)._assign(e)}return Promise.reject(new l.NetworkResponse(404,"Object not found in cache."))}}.bind(this))},t.prototype._save=function(t,e){var i=this,r=!t._getMcsURI(),a=r?this.backend.getCustomCodeUrl(this.apiName+"/"+this.endpointPath):this._getMcsURI(t),u=r?new o.PostProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options):new s.PutProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),c=JSON.stringify(t),l=new d.Dictionary([]);return l.add(h.Headers.ACCEPT,h.ContentTypes.APPLICATION_JSON),l.add(h.Headers.CONTENT_TYPE,h.ContentTypes.APPLICATION_JSON),u.performRequest(a,l,c).then(function(e){var r=e.data;return"string"==typeof r&&(r=""!==r?JSON.parse(r):null),i._updateMobileObject(t,r),t.__proto__=new n.MobileObject(i,e.uri),t})},t.prototype._delete=function(t){var e=this,i=new a.DeleteProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),n=this._getMcsURI(t);return i.performRequest(n).then(function(i){return e._updateMobileObject(t._syncResource),t._syncResource=null,i})},t.prototype._getMcsURI=function(t){var e=t._getMcsURI();return e.startsWith("http")?e:this.backend._baseUrl+e},t.prototype._updateMobileObject=function(t,e){for(var i in void 0===e&&(e={}),t)t.hasOwnProperty(i)&&delete t[i];for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},t.prototype._executeFetchObjects=function(t,e,i,r,o,s){var a=this,c=this.backend.getHttpHeaders(t);c.add(h.Headers.ORACLE_MOBILE_SYNC_AGENT,"true");var l={method:h.HttpMethods.GET,url:this.backend.getCustomCodeUrl(this.apiName+"/"+this.endpointPath),headers:c,module:h.ModuleNames.SYNC};return this.platform.invokeService(l).then(function(t){var e=t.data;"string"==typeof e&&(e=""!==e?JSON.parse(e):null);var i=[];for(var r in e.items)if(e.items.hasOwnProperty(r)){var o=e.items[r],s="/"+e.uris[r];i.push(new n.MobileObject(a,s)._assign(o))}return new u.MobileObjectCollection(a,null).initialize(i)}.bind(this))},t.prototype.fetchObjects=function(){return new c.FetchCollectionBuilder(this)},t}();e.MobileEndpoint=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(32),r=i(1),o=function(){function t(t,e,i,n,o,s){this.utils=e,this.platform=i,this.common=n,this.options=o,this.process=s,this._endpoints={},this.logger=new r.Logger("Synchronization"),this.backend=t,o._originalIsOnline||(o._originalIsOnline=o.isOnline.bind(o));var a=!1;o.isOnline=function(){return!1===a?o._originalIsOnline():!a},this.setOfflineMode=function(t){a="boolean"!=typeof t||t}}return t.prototype.isOnline=function(){return this.options.isOnline()},t.prototype.purge=function(){for(var t in this._endpoints)if(this._endpoints.hasOwnProperty(t)){var e=this._endpoints[t];for(var i in e)e.hasOwnProperty(i)&&e[i].purge()}},t.prototype.openEndpoint=function(t,e){return this._endpoints[t]=this._endpoints[t]||{},this._endpoints[t][e]=this._endpoints[t][e]||new n.MobileEndpoint(this,t,e,this.backend,this.utils,this.platform,this.common,this.options),this._endpoints[t][e]},t.prototype._run=function(t){return this.process.run(t)},t.prototype._runWithoutReadInBackground=function(t){return this.process.runWithoutReadInBackground(t)},t}();e.Synchronization=o},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(4),s=i(1),a=i(2),u=i(7),c=i(0),l=i(3),h=function(t){function e(e,i,n,r,o,a){var u=t.call(this,n,o,a)||this;return u.oAuthTokenEndPoint=e,u.config=i,u.logger=new s.Logger("OAuthAuthorization"),u._clientId=o.validateConfiguration(i.clientId),u._clientSecret=o.validateConfiguration(i.clientSecret),u._tenantName=o.validateConfiguration(r),u}return r(e,t),e.prototype.getAuthorizedUserName=function(){return this._authorizedUserName},e.prototype.getClientId=function(){return this._clientId},e.prototype.getTenantName=function(){return this._tenantName},e.prototype.getClientSecret=function(){return this._clientSecret},e.prototype.authenticate=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t[0],r=t[1];if(this.logout(),!n||!r)return this.logger.error("Wrong username or password parameter"),Promise.reject(new a.NetworkResponse(400,"Bad Request"));var o="Basic "+this.utils.encodeBase64(this._clientId+":"+this._clientSecret),s=this.config.scope||this.backend._baseUrl+"urn:opc:resource:consumer::all",u=e.urlEncodeComponent(n,r,s),h=new l.Dictionary([]);return h.add(c.Headers.CONTENT_TYPE,c.ContentTypes.X_WWW_FORM_FORM_URLENCODED),h.add(c.Headers.AUTHORIZATION,o),void 0!==this._tenantName&&h.add(c.Headers.X_RESOURCE_IDENTITY_DOMAIN_NAME,this._tenantName),this.platform.invokeService({headers:h,url:this.getOAuthTokenUrl(),method:c.HttpMethods.POST,data:u,withCredentials:!1,module:c.ModuleNames.AUTHORIZATION}).then(function(t){return this._authenticateSuccess(t,t.data.access_token),this._authorizedUserName=n,t}.bind(this)).catch(function(t){return this._authenticateError(t),Promise.reject(t)}.bind(this))},e.prototype.authenticateAnonymous=function(){var t=new l.Dictionary([]);t.add(c.Headers.CONTENT_TYPE,c.ContentTypes.X_WWW_FORM_FORM_URLENCODED),void 0!==this._tenantName&&t.add(c.Headers.X_USER_IDENTITY_DOMAIN_NAME,this._tenantName);var e=this.config.scope||this.backend._baseUrl+"urn:opc:resource:consumer::all",i="grant_type=client_credentials&scope="+encodeURIComponent(e);return this._authenticateAnonymousInvoke(t,this.getOAuthTokenUrl(),c.HttpMethods.POST,!1,i).then(function(t){return this._tokenExpiredTime=Date.now()+1e3*t.data.expires_in,t}.bind(this))},e.prototype._getAnonymousAuthorizationHeaders=function(t){return t.add(c.Headers.AUTHORIZATION,"Basic "+this.utils.encodeBase64(this.getClientId()+":"+this.getClientSecret())),t},e.prototype.isTokenValid=function(){return!(!this.getAccessToken()&&!this._getAnonymousAccessToken())&&(this.logger.debug("Token is not null or empty"),Date.now()>=this._tokenExpiredTime?(this.logger.info("Token has expired"),!1):(this.logger.debug("Token is still valid"),!0))},e.prototype.logout=function(){this._clearState()},e.prototype.refreshToken=function(){var t=this.isTokenValid();return t&&!this.getAccessToken()&&this._getIsAnonymous()?Promise.resolve(new a.NetworkResponse(200,this._getAnonymousAccessToken())):!t||this._getAnonymousAccessToken()||this._getIsAnonymous()?(this.logger.error("Token has expired or user has not been authenticate with the service."),Promise.resolve(new a.NetworkResponse(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."))):Promise.resolve(new a.NetworkResponse(200,this._getAnonymousAccessToken()))},e.prototype._anonymousTokenResponseConverter=function(t){return new o.AuthenticationResponse(t,t.data.access_token)},e.prototype._clearState=function(){t.prototype._clearState.call(this),this._authorizedUserName=null,this._tokenExpiredTime=1e3*Date.now()},e.prototype._getHttpHeaders=function(t){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&t.add(c.Headers.AUTHORIZATION,"Bearer "+this.getAccessToken()),t},e.prototype._getAnonymousHttpHeaders=function(t){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&t.add(c.Headers.AUTHORIZATION,"Bearer "+this._getAnonymousAccessToken()),t},e.urlEncodeComponent=function(t,e,i){return"grant_type=password&username="+(t.indexOf("@")>-1?encodeURIComponent(t).replace(/%20/g,"+"):encodeURIComponent(t).replace(/%5B/g,"[").replace(/%5D/g,"]"))+"&password="+(e.indexOf("&")>-1?encodeURIComponent(e).replace(/%20/g,"+"):encodeURIComponent(e).replace(/%5B/g,"[").replace(/%5D/g,"]"))+"&scope="+encodeURIComponent(i)},e.prototype.getOAuthTokenUrl=function(){var t=this.utils.validateConfiguration(this.oAuthTokenEndPoint);return this.utils.strEndsWith(t,"/oauth2/v1/token")||(t+="/oauth2/v1/token"),t},e}(u.MCSAuthorization);e.OAuthAuthorization=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this._id=t.id,this._userName=t.username,this._firstName=t._firstName,this._lastName=t._lastName,this._email=t.email}return t.prototype.getId=function(){return this._id},t.prototype.getFirstName=function(){return this._firstName},t.prototype.getLastName=function(){return this._lastName},t.prototype.getEmail=function(){return this._email},t}();e.User=n},function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(4),s=i(1),a=i(2),u=i(7),c=i(0),l=i(3),h=function(t){function e(e,i,n,r){var o=t.call(this,i,n,r)||this;return o._logger=new s.Logger("BasicAuthorization"),o._backendId=n.validateConfiguration(e.mobileBackendId),o._anonymousToken=n.validateConfiguration(e.anonymousKey),o}return r(e,t),e.prototype.getAuthorizedUserName=function(){return this._authorizedUserName},e.prototype.authenticate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1];if(this.logout(),!i||!n)return this._logger.error("Wrong username or password parameter"),Promise.reject(new a.NetworkResponse(400,"Bad Request"));var r="Basic "+this.utils.encodeBase64(i+":"+n),o=new l.Dictionary([]);return o.add(c.Headers.AUTHORIZATION,r),o.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),this.platform.invokeService({headers:o,url:this.backend.getPlatformUrl("users/login"),method:c.HttpMethods.GET,module:c.ModuleNames.AUTHORIZATION}).then(function(t){return this._authenticateSuccess(t,r),this._authorizedUserName=i,t}.bind(this)).catch(function(t){return this._authenticateError(t),Promise.reject(t)}.bind(this))},e.prototype.authenticateAnonymous=function(){return this._authenticateAnonymousInvoke(new l.Dictionary([]),this.backend.getPlatformUrl("users/login"),c.HttpMethods.GET)},e.prototype._getAnonymousAuthorizationHeaders=function(t){return t.add(c.Headers.AUTHORIZATION,"Basic "+this._anonymousToken),t.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype.isTokenValid=function(){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()?(this._logger.info("Authorization token is not null or empty"),!0):null==this.getAccessToken()&&"string"!=typeof this.getAccessToken()?(this._logger.info("Authorization token is null and/or empty"),!1):void 0},e.prototype.refreshToken=function(){return this._getIsAuthorized()||this.isTokenValid()?this._getIsAuthorized()&&this.isTokenValid()?(this._logger.debug("Authenticated token is valid, you do not need to refresh."),Promise.resolve(new a.NetworkResponse(200,this.getAccessToken()))):void 0:Promise.reject(new a.NetworkResponse(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."))},e.prototype.logout=function(){this._clearState()},e.prototype._anonymousTokenResponseConverter=function(t){return new o.AuthenticationResponse(t,"Basic "+this._anonymousToken)},e.prototype._getHttpHeaders=function(t){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&t.add(c.Headers.AUTHORIZATION,this.getAccessToken()),t.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype._getAnonymousHttpHeaders=function(t){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&t.add(c.Headers.AUTHORIZATION,this._getAnonymousAccessToken()),t.add(c.Headers.ORACLE_MOBILE_BACKEND_ID,this._backendId),t},e.prototype._clearState=function(){t.prototype._clearState.call(this),this._authorizedUserName=null},e}(u.MCSAuthorization);e.BasicAuthorization=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(18),r=i(1),o=i(2),s=i(0),a=function(){function t(t,e,i,n){this.config=t,this.backend=e,this.platform=i,this.utils=n,this.events=[],this.logger=new r.Logger("Analytics")}return t.prototype.getSessionId=function(){return this.sessionId},t.prototype.startSession=function(){this.sessionId||(this._locationEnabled()&&this.platform.initGPSLocation(),this.sessionId=this.utils.uuid(),this.logNamedEvent("sessionStart").type="system")},t.prototype.endSession=function(){return this.sessionId?(this.logNamedEvent("sessionEnd").type="system",this.logger.debug("Deactivate a default session"),this.flush().then(function(t){return this.sessionId=void 0,t}.bind(this))):Promise.reject(new o.NetworkResponse(500,"Session ID is null"))},t.prototype.logNamedEvent=function(t){var e=new n.AnalyticsEvent(t);return this.logEvent(e),e},t.prototype.logEvent=function(t){return 0===this.events.length&&(this.events[0]=this._createContextEvent()),this.startSession(),this.events[this.events.length]=t,t.sessionID=this.sessionId,t},t.prototype.flush=function(){for(var t=0;t<this.events.length;t++){if(this._locationEnabled()&&"context"==this.events[t].name){var e=this.platform.getGPSLocation();null!=e&&null!=e.latitude&&(this.events[t].properties.latitude=e.latitude),null!=e&&null!=e.longitude&&(this.events[t].properties.longitude=e.longitude)}}var i=JSON.stringify(this.events),n=this.backend.getHttpHeaders();return n.add(s.Headers.CONTENT_TYPE,s.ContentTypes.APPLICATION_JSON),this.platform.invokeService({headers:n,method:s.HttpMethods.POST,url:this.backend.getPlatformUrl("analytics/events"),data:i,module:s.ModuleNames.MCS_ANALYTICS}).then(function(t){return this.logger.debug("Analytics events flushed."),this.events=[],t}.bind(this),function(t){return this.logger.error("Failed to flush analytics events."),Promise.reject(t)}.bind(this))},t.prototype._createContextEvent=function(){var t=new n.AnalyticsEvent("context");t.type="system",t.sessionID=this.sessionId,t.properties.timezone=""+60*(new Date).getTimezoneOffset();var e=this.platform.getDeviceInformation();return t.properties.model=e.model,t.properties.manufacturer=e.manufacturer,t.properties.osName=e.osName,t.properties.osVersion=e.osVersion,t.properties.osBuild=e.osBuild,t.properties.carrier=e.carrier,t},t.prototype._getEvents=function(){return this.events},t.prototype._locationEnabled=function(){return void 0===this.config.disableAnalyticsLocation||this.config.disableAnalyticsLocation},t}();e.Analytics=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(2),r=i(0),o=function(){function t(t,e){this.backend=t,this.platform=e}return t.prototype.invokeCustomCodeJSONRequest=function(e,i,o){if(i in t.httpMethods){if(i===t.httpMethods.DELETE&&o)return Promise.reject(new n.NetworkResponse(500,"DELETE method content body"));var s=this.backend.getHttpHeaders();s.add(r.Headers.CONTENT_TYPE,r.ContentTypes.APPLICATION_JSON);var a=o?JSON.stringify(o):null;return this.platform.invokeService({method:i,headers:s,url:this.backend.getCustomCodeUrl(e),data:a,module:r.ModuleNames.CUSTOM_CODE})}return Promise.reject(new n.NetworkResponse(501,"Method Not Implemented"))},t.httpMethods={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH"},t}();e.CustomCode=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=i(3),o=i(0),s=function(){function t(t,e){this.platform=t,this.logger=new n.Logger("Diagnostics"),this._sessionId=e.uuid()}return t.prototype._getHttpHeaders=function(t){return void 0===t&&(t=new r.Dictionary([])),t.add(o.Headers.ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID,this.getSessionId()),t.add(o.Headers.ORACLE_MOBILE_DEVICE_ID,this.platform.getDeviceId()),t.add(o.Headers.ORACLE_MOBILE_CLIENT_REQUEST_TIME,(new Date).toISOString()),t},t.prototype.getSessionId=function(){return this._sessionId},t}();e.Diagnostics=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=i(39),o=i(38),s=i(37),a=i(36),u=i(34),c=i(33),l=i(24),h=i(0),d=i(3),p=function(){function t(t,e,i,a){this.config=t,this.platform=e,this.utils=i,this.syncExpress=a,this.PLATFORM_PATH="mobile/platform",this.CUSTOM_CODE_PATH="mobile/custom",this._authenticationType=null,this._logger=new n.Logger("MobileBackend"),this.name=null,this.authorization=null,this.diagnostics=null,this.customCode=null,this.analytics=null,this.storage=null,this.synchronization=null,this.appConfig={},this._mbeConfig=t.mobileBackend,this.name=this._mbeConfig.name,this.diagnostics=new r.Diagnostics(e,i),this.customCode=new o.CustomCode(this,e),this.analytics=new s.Analytics(t,this,e,i),this.storage=new l.Storage(this,i,e),this._baseUrl=i.validateConfiguration(this._mbeConfig.baseUrl),this._authenticationTypes=Object.assign({},h.AuthenticationTypes,{facebook:void 0,token:void 0}),console.log("constructor",JSON.stringify(this._authenticationTypes)),a&&(this.synchronization=new c.Synchronization(this,i,e,a.common,a.options,a.process)),this._mbeConfig.authentication.type&&this.setAuthenticationType(this._mbeConfig.authentication.type)}return t.prototype.getPlatformUrl=function(t){var e=this._baseUrl;return this._authenticationType===h.AuthenticationTypes.oauth&&this.utils.strEndsWith(this._baseUrl,"1")&&(e=e.substring(0,e.length-4)+"7777"),e=this.utils.validateConfiguration(e)+"/"+this.PLATFORM_PATH,this.utils.strEndsWith(e,"/")||(e+="/"),e+t},t.prototype.getCustomCodeUrl=function(t){return this.utils.validateConfiguration(this._baseUrl)+this._getCustomCodeUri(t)},t.prototype.getHttpHeaders=function(t){void 0===t&&(t=new d.Dictionary([]));var e=this.authorization,i=this.diagnostics._getHttpHeaders(t);return e&&(i=e._getIsAuthorized()&&e._getIsAnonymous()?e._getAnonymousHttpHeaders(i):e._getHttpHeaders(i)),i},t.prototype.getAuthenticationType=function(){return this._authenticationType},t.prototype.setAuthenticationType=function(t){var e=this.utils.validateConfiguration(t);if(this.authorization=null,!this._authenticationTypes[e])throw Error("Wrong Authentication type: "+t+", please use one of: \n"+this._getAuthenticationTypesMessage(this._authenticationTypes));if(!this._mbeConfig.authentication[e])throw Error("No Authentication Type called "+t+" is defined in configuration \ncheck configuration in authorization object for the following objects:\n"+this._getAuthenticationTypesMessage(this._authenticationTypes));if(this.authorization&&this.authorization._getIsAuthorized()&&this.authorization.logout(),e===h.AuthenticationTypes.basic)this.authorization=new a.BasicAuthorization(this._mbeConfig.authentication.basic,this,this.utils,this.platform),this._logger.info("Your Authentication type: "+e),this._authenticationType=e;else if(e===h.AuthenticationTypes.oauth){var i=this._mbeConfig;this.authorization=new u.OAuthAuthorization(this.config.oAuthTokenEndPoint,this._mbeConfig.authentication.oauth,this,i.tenantId,this.utils,this.platform),this._logger.info("Your Authentication type: "+e),this._authenticationType=e}return this.authorization},t.prototype.loadAppConfig=function(){var t=this.getHttpHeaders();t.add(h.Headers.CONTENT_TYPE,h.ContentTypes.APPLICATION_JSON);var e=this.authorization;return e._getIsAuthorized()||(t=e._getAnonymousAuthorizationHeaders(t)),this.platform.invokeService({headers:t,method:h.HttpMethods.GET,url:this.getPlatformUrl("appconfig/client"),module:h.ModuleNames.APP_CONFIG}).catch(function(t){return this.logger.error("App config download failed! with status code: "+t.statusCode),Promise.reject(t)}.bind(this))},t.prototype._getCustomCodeUri=function(t){var e="/"+this.CUSTOM_CODE_PATH,i=t;return this.utils.strEndsWith(i,"/")&&(i=i.slice(0,-1)),e+"/"+i},t.prototype._getAuthenticationTypesMessage=function(t){var e=this;return Object.keys(this._authenticationTypes).filter(function(t){return!!e._authenticationTypes[t]}).map(function(t){return e._authenticationTypes[t]}).join("\n")},t}();e.Backend=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.POLICIES_MAP={fetchPolicy:{persistencePropertyName:"fetchPolicy",FETCH_FROM_CACHE_SCHEDULE_REFRESH:"FETCH_FROM_CACHE_SCHEDULE_REFRESH",FETCH_FROM_SERVICE_IF_ONLINE:"FETCH_FROM_SERVICE_IF_ONLINE",FETCH_FROM_CACHE:"FETCH_FROM_CACHE",FETCH_FROM_SERVICE:"FETCH_FROM_SERVICE",FETCH_FROM_SERVICE_ON_CACHE_MISS:"FETCH_FROM_SERVICE_ON_CACHE_MISS",FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY:"FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY",FETCH_WITH_REFRESH:"FETCH_WITH_REFRESH"},evictionPolicy:{persistencePropertyName:"evictionPolicy",EVICT_ON_EXPIRY_AT_STARTUP:"EVICT_ON_EXPIRY_AT_STARTUP",MANUAL_EVICTION:"MANUAL_EVICTION"},expirationPolicy:{persistencePropertyName:"expirationPolicy",EXPIRE_ON_RESTART:"EXPIRE_ON_RESTART",EXPIRE_AFTER:"EXPIRE_AFTER",NEVER_EXPIRE:"NEVER_EXPIRE"},updatePolicy:{persistencePropertyName:"updatePolicy",QUEUE_IF_OFFLINE:"QUEUE_IF_OFFLINE",UPDATE_IF_ONLINE:"UPDATE_IF_ONLINE"},refreshPolicy:{persistencePropertyName:"refreshPolicy",PeriodicallyRefreshExpiredResource:""},conflictResolutionPolicy:{persistencePropertyName:"conflictResolutionPolicy",SERVER_WINS:"SERVER_WINS",PRESERVE_CONFLICT:"PRESERVE_CONFLICT",CLIENT_WINS:"CLIENT_WINS"},noCache:{persistencePropertyName:"noCache",false:!1,true:!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.removeSpace=function(t){return t.replace(/ /g,"")},t.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},t.prototype.validateConfiguration=function(t){var e=t;return/\s/.test(e)&&e&&(e=this.removeSpace(t)),e},t.prototype.encodeBase64=function(e){var i,n,r,o,s,a="",u="",c="",l=0;do{r=(i=e.charCodeAt(l++))>>2,o=(3&i)<<4|(n=e.charCodeAt(l++))>>4,s=(15&n)<<2|(u=e.charCodeAt(l++))>>6,c=63&u,isNaN(n)?s=c=64:isNaN(u)&&(c=64),a=a+t.KEY_STR.charAt(r)+t.KEY_STR.charAt(o)+t.KEY_STR.charAt(s)+t.KEY_STR.charAt(c),i=n=u="",r=o=s=c=""}while(l<e.length);return a},t.prototype.decodeBase64=function(e){var i,n,r,o,s,a,u="",c=0;if(/[^A-Za-z0-9\+\/\=]/g.exec(e))return null;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{i=t.KEY_STR.indexOf(e.charAt(c++))<<2|(o=t.KEY_STR.indexOf(e.charAt(c++)))>>4,n=(15&o)<<4|(s=t.KEY_STR.indexOf(e.charAt(c++)))>>2,r=(3&s)<<6|(a=t.KEY_STR.indexOf(e.charAt(c++))),u+=String.fromCharCode(i),64!=s&&(u+=String.fromCharCode(n)),64!=a&&(u+=String.fromCharCode(r))}while(c<e.length);return u},t.prototype.clearNonPrintableCharacters=function(e){return e.replace(t.SPECIAL_CHAR_RGX,"")},t.prototype.hasValue=function(t,e,i){return t.hasOwnProperty(e)&&t[e]===i},t.prototype.isEquivalentURL=function(t,e){return 0===t.indexOf("https")&&0===e.indexOf("https")?(t=443===this.getPort(t)?t.replace(":443",""):t,e=443===this.getPort(e)?e.replace(":443",""):e):-1===t.indexOf("https")&&-1===e.indexOf("https")&&(t=80===this.getPort(t)?t.replace(":80",""):t,e=80===this.getPort(e)?e.replace(":80",""):e),0===t.indexOf(e)},t.prototype.getPort=function(t){var e=t.indexOf(":",7),i=t.indexOf("/",e);e>0&&-1==i&&(i=t.length);var n=t.substr(e+1,i-e-1);return n&&!isNaN(1*n)?1*n:-1},t.prototype.parseHeaders=function(t){var e={};if(!t)return e;for(var i=t.split("\r\n"),n=0,r=i.length;n<r;n++){var o=i[n],s=o.indexOf(": ");s>0&&(e[o.substring(0,s).toLowerCase()]=o.substring(s+2))}return e},t.prototype.normalizeHeaderKeys=function(t){var e={};if(this.isArray(t))for(var i=t,n=0;n<i.length;n++)e[i[n].name.toLowerCase()]=i[n].value;else for(var r in t)t.hasOwnProperty(r)&&(e[r.toLowerCase()]=t[r]);return e},t.prototype.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.prototype.isCordova=function(){return void 0!==window.cordova},t.prototype.strEndsWith=function(t,e){return t.endsWith(e)},t.prototype.hashCode=function(t){return t.split("").reduce(function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t},0)},t.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t.SPECIAL_CHAR_RGX=/[\0-\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g,t}();e.Utils=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(42),r=i(1),o=i(18),s=i(17),a=i(41),u=i(0),c=function(){function t(t,e,i){void 0===i&&(i=null),this.cxa=t,this._global=e,this._logger=new r.Logger("MCS"),this._utils=new n.Utils,this.LOG_LEVEL=r.Logger.LOG_LEVEL,this.AUTHENTICATION_TYPES=u.AuthenticationTypes,this.RESPONSE_TYPES=u.XMLHttpRequestResponseTypes,this.HTTP_METHODS=u.HttpMethods,this.NOTIFICATION_PROVIDERS=u.NotificationProviders,this._getLogHistory=function(){return r.Logger.history},this.StorageObject=s.StorageObject,this.AnalyticsEvent=o.AnalyticsEvent,this._syncExpress=i||(void 0!==e.mcs?e.mcs.sync:null)}return t.prototype._init=function(t){this._config=Object.assign({mcsVersion:"18.3.3.0"},t),void 0!==t.logLevel?r.Logger.logLevel=t.logLevel:r.Logger.logLevel=this.LOG_LEVEL.NONE;var e=this._config;this._logger.debug("MCS initialization, version",e.mcsVersion),void 0!==e.logHistoryEnabled&&(r.Logger.historyEnabled=e.logHistoryEnabled),void 0!==e.logHistorySize&&(r.Logger.historySize=e.logHistorySize),void 0!==e.mcsGlobal&&e.mcsGlobal&&(this._global.mcs=Object.assign({},this._global.mcs,this)),this._syncExpress?this._initPersistenceConfiguration(t):(t.sync||t.syncExpress)&&this._logger.warn("Sync script was not included on page, switch caching off"),this._platform=this._getPlatform(this._config,this._utils)},t.prototype._initPersistenceConfiguration=function(t){var e=this._syncExpress;e._setLogLevel(t.logLevel),e._setLogHTTP(t.logHTTP);var i=null;if(t.sync&&t.syncExpress)throw Error("Configuration contains two types synchronisation, please choose one of those types, switch caching off");if(t.sync)i=t.sync,e.setHandler(e.SYNC_REQUEST_HANDLER_TYPE.MCS);else{if(!t.syncExpress)return this._logger.warn("Missing synchronization configuration, switch caching off"),void e.options.switchOff();i=t.syncExpress;var n=t.syncExpress.handler&&"OracleRestHandler"===t.syncExpress.handler;e.setHandler(n?e.SYNC_REQUEST_HANDLER_TYPE.ORACLE_REST:e.SYNC_REQUEST_HANDLER_TYPE.GENERIC)}e.options.switchOff(!1);var r={default:{conflictResolutionPolicy:"CLIENT_WINS",expirationPolicy:"NEVER_EXPIRE",expireAfter:600,evictionPolicy:"MANUAL_EVICTION",fetchPolicy:"FETCH_FROM_SERVICE_IF_ONLINE",updatePolicy:"QUEUE_IF_OFFLINE",noCache:!1},periodicRefreshInterval:i.backgroundRefreshPolicy||120,policies:[],periodicRefreshPolicy:null},o=i.policies;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];a?r.policies.push(this._getPersistencePolicy(a)):this._logger.error("The "+a+"policy was not found in accepted policies.")}e.options.setPolicies(r),e.options.dbFirst=!1,e.options.setMaxSyncAttempts(1),e.options.setAutoRemoveAfterReachMaxAttempts(!0)},t.prototype._getPersistencePolicy=function(t){var e={path:t.path};for(var i in t)if(t.hasOwnProperty(i)&&"path"!==i){var n=a.POLICIES_MAP[i];n?void 0===n[t[i]]?this._logger.error("The "+i+" policy value "+t[i]+" was not found in accepted policy values."):e[n.persistencePropertyName]=n[t[i]]:this._logger.error("The "+i+" policy was not found in accepted policies.")}return e},t}();e.MCSModule=c},,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(21),s=i(1),a=i(0),u=function(t){function e(e,i,n,r){var o=t.call(this,e,i,r||new s.Logger("BrowserPlatform"))||this;return o._navigator=n,o.isBrowser=!0,o.isCordova=!1,o}return r(e,t),e.prototype.getDevicePlatform=function(){var t=this._navigator.userAgent;return t.match(/Android/i)?a.DevicePlatforms.ANDROID:t.match(/iPad/i)||t.match(/iPod/i)||t.match(/iPhone/i)?a.DevicePlatforms.IOS:void 0},e.prototype._getPlatform=function(){return a.PlatformNames.JAVASCRIPT},e}(o.Platform);e.BrowserPlatform=u},,,,,,,,,function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(43),s=i(40),u=i(59),c=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.mobileBackend=null,n}return r(e,t),e.prototype.init=function(t){this._init(t),t.mobileBackend&&(this.mobileBackend=new s.Backend(this._config,this._platform,this._utils,this._syncExpress))},e.prototype._getPlatform=function(t,e){return this._logger.debug("Create Browser platform"),new u.BrowserPlatform(t,e,navigator)},e}(o.MCSModule);e.MCSWebModule=c,a=c}]);var c=new a(function(t,e,i,n,r){},u=void 0!==n?n:void 0!==r?r:void 0!==o?o:s);"object"==typeof e&&void 0!==t?t.exports=c:"function"==typeof i&&i.amd?i([],c):u.mcs=c}("undefined"==typeof module?void 0:module,"undefined"==typeof exports?void 0:exports,"undefined"==typeof define?void 0:define,"undefined"==typeof window?void 0:window,"undefined"==typeof global?void 0:global,"undefined"==typeof self?void 0:self,this);